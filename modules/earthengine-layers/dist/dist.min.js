var EarthEngineLayerLibrary=function(t,e,r,n){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function o(t,e,r){return e&&a(t.prototype,e),r&&a(t,r),t}function u(t){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function s(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function c(t,e){return!e||"object"!==u(e)&&"function"!=typeof e?s(t):e}function l(t){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function h(t,e){return(h=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function f(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&h(t,e)}function d(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function p(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t)){var r=[],n=!0,i=!1,a=void 0;try{for(var o,u=t[Symbol.iterator]();!(n=(o=u.next()).done)&&(r.push(o.value),!e||r.length!==e);n=!0);}catch(t){i=!0,a=t}finally{try{n||null==u.return||u.return()}finally{if(i)throw a}}return r}}(t,e)||function(t,e){if(t){if("string"==typeof t)return d(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(r):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?d(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}n=n&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n;var v=function(){function e(t){var r=t.x,n=t.y,a=t.z,o=t.onTileLoad,u=t.onTileError;i(this,e),this.x=r,this.y=n,this.z=a,this.isVisible=!1,this.parent=null,this.children=[],this.content=null,this._isLoaded=!1,this.onTileLoad=o,this.onTileError=u}return o(e,[{key:"loadData",value:function(t){var e=this,r=this.x,n=this.y,i=this.z,a=this.bbox;t&&(this._loader=Promise.resolve(t({x:r,y:n,z:i,bbox:a})).then((function(t){return e.content=t,e._isLoaded=!0,e.onTileLoad(e),t})).catch((function(t){e._isLoaded=!0,e.onTileError(t)})))}},{key:"data",get:function(){return this._isLoaded?this.content:this._loader}},{key:"isLoaded",get:function(){return this._isLoaded}},{key:"byteLength",get:function(){var e=this.content?this.content.byteLength:0;return Number.isFinite(e)||t.log.error("byteLength not defined in tile data")(),e}}]),e}(),y="undefined"!=typeof Float32Array?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var m,g;m=new y(4),y!=Float32Array&&(m[0]=0,m[1]=0,m[2]=0,m[3]=0),g=m;function b(t,e){var r=function(t,e,r){var n=e[0],i=e[1],a=e[2],o=e[3];return t[0]=r[0]*n+r[4]*i+r[8]*a+r[12]*o,t[1]=r[1]*n+r[5]*i+r[9]*a+r[13]*o,t[2]=r[2]*n+r[6]*i+r[10]*a+r[14]*o,t[3]=r[3]*n+r[7]*i+r[11]*a+r[15]*o,t}([],e,t);return function(t,e,r){t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r}(r,r,1/r[3]),r}function w(t,e){var r=e[0],n=e[1],i=e[2],a=e[3],o=e[4],u=e[5],s=e[6],c=e[7],l=e[8],h=e[9],f=e[10],d=e[11],p=e[12],v=e[13],y=e[14],m=e[15],g=r*u-n*o,b=r*s-i*o,w=r*c-a*o,M=n*s-i*u,x=n*c-a*u,L=i*c-a*s,_=l*v-h*p,j=l*y-f*p,S=l*m-d*p,T=h*y-f*v,k=h*m-d*v,E=f*m-d*y,P=g*E-b*k+w*T+M*S-x*j+L*_;return P?(P=1/P,t[0]=(u*E-s*k+c*T)*P,t[1]=(i*k-n*E-a*T)*P,t[2]=(v*L-y*x+m*M)*P,t[3]=(f*x-h*L-d*M)*P,t[4]=(s*S-o*E-c*j)*P,t[5]=(r*E-i*S+a*j)*P,t[6]=(y*w-p*L-m*b)*P,t[7]=(l*L-f*w+d*b)*P,t[8]=(o*k-u*S+c*_)*P,t[9]=(n*S-r*k-a*_)*P,t[10]=(p*x-v*w+m*g)*P,t[11]=(h*w-l*x-d*g)*P,t[12]=(u*j-o*T-s*_)*P,t[13]=(r*T-n*j+i*_)*P,t[14]=(v*b-p*M-y*g)*P,t[15]=(l*M-h*b+f*g)*P,t):null}function M(t,e,r){var n=e[0],i=e[1],a=e[2],o=e[3],u=e[4],s=e[5],c=e[6],l=e[7],h=e[8],f=e[9],d=e[10],p=e[11],v=e[12],y=e[13],m=e[14],g=e[15],b=r[0],w=r[1],M=r[2],x=r[3];return t[0]=b*n+w*u+M*h+x*v,t[1]=b*i+w*s+M*f+x*y,t[2]=b*a+w*c+M*d+x*m,t[3]=b*o+w*l+M*p+x*g,b=r[4],w=r[5],M=r[6],x=r[7],t[4]=b*n+w*u+M*h+x*v,t[5]=b*i+w*s+M*f+x*y,t[6]=b*a+w*c+M*d+x*m,t[7]=b*o+w*l+M*p+x*g,b=r[8],w=r[9],M=r[10],x=r[11],t[8]=b*n+w*u+M*h+x*v,t[9]=b*i+w*s+M*f+x*y,t[10]=b*a+w*c+M*d+x*m,t[11]=b*o+w*l+M*p+x*g,b=r[12],w=r[13],M=r[14],x=r[15],t[12]=b*n+w*u+M*h+x*v,t[13]=b*i+w*s+M*f+x*y,t[14]=b*a+w*c+M*d+x*m,t[15]=b*o+w*l+M*p+x*g,t}function x(t,e,r){var n,i,a,o,u,s,c,l,h,f,d,p,v=r[0],y=r[1],m=r[2];return e===t?(t[12]=e[0]*v+e[4]*y+e[8]*m+e[12],t[13]=e[1]*v+e[5]*y+e[9]*m+e[13],t[14]=e[2]*v+e[6]*y+e[10]*m+e[14],t[15]=e[3]*v+e[7]*y+e[11]*m+e[15]):(n=e[0],i=e[1],a=e[2],o=e[3],u=e[4],s=e[5],c=e[6],l=e[7],h=e[8],f=e[9],d=e[10],p=e[11],t[0]=n,t[1]=i,t[2]=a,t[3]=o,t[4]=u,t[5]=s,t[6]=c,t[7]=l,t[8]=h,t[9]=f,t[10]=d,t[11]=p,t[12]=n*v+u*y+h*m+e[12],t[13]=i*v+s*y+f*m+e[13],t[14]=a*v+c*y+d*m+e[14],t[15]=o*v+l*y+p*m+e[15]),t}function L(t,e,r){var n=r[0],i=r[1],a=r[2];return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*a,t[9]=e[9]*a,t[10]=e[10]*a,t[11]=e[11]*a,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function _(t,e){var r=t[0],n=t[1],i=t[2],a=t[3],o=t[4],u=t[5],s=t[6],c=t[7],l=t[8],h=t[9],f=t[10],d=t[11],p=t[12],v=t[13],y=t[14],m=t[15],g=e[0],b=e[1],w=e[2],M=e[3],x=e[4],L=e[5],_=e[6],j=e[7],S=e[8],T=e[9],k=e[10],E=e[11],P=e[12],z=e[13],O=e[14],F=e[15];return Math.abs(r-g)<=1e-6*Math.max(1,Math.abs(r),Math.abs(g))&&Math.abs(n-b)<=1e-6*Math.max(1,Math.abs(n),Math.abs(b))&&Math.abs(i-w)<=1e-6*Math.max(1,Math.abs(i),Math.abs(w))&&Math.abs(a-M)<=1e-6*Math.max(1,Math.abs(a),Math.abs(M))&&Math.abs(o-x)<=1e-6*Math.max(1,Math.abs(o),Math.abs(x))&&Math.abs(u-L)<=1e-6*Math.max(1,Math.abs(u),Math.abs(L))&&Math.abs(s-_)<=1e-6*Math.max(1,Math.abs(s),Math.abs(_))&&Math.abs(c-j)<=1e-6*Math.max(1,Math.abs(c),Math.abs(j))&&Math.abs(l-S)<=1e-6*Math.max(1,Math.abs(l),Math.abs(S))&&Math.abs(h-T)<=1e-6*Math.max(1,Math.abs(h),Math.abs(T))&&Math.abs(f-k)<=1e-6*Math.max(1,Math.abs(f),Math.abs(k))&&Math.abs(d-E)<=1e-6*Math.max(1,Math.abs(d),Math.abs(E))&&Math.abs(p-P)<=1e-6*Math.max(1,Math.abs(p),Math.abs(P))&&Math.abs(v-z)<=1e-6*Math.max(1,Math.abs(v),Math.abs(z))&&Math.abs(y-O)<=1e-6*Math.max(1,Math.abs(y),Math.abs(O))&&Math.abs(m-F)<=1e-6*Math.max(1,Math.abs(m),Math.abs(F))}function j(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t}function S(t,e,r,n){var i=e[0],a=e[1];return t[0]=i+n*(r[0]-i),t[1]=a+n*(r[1]-a),t}!function(){var t=function(){var t=new y(2);return y!=Float32Array&&(t[0]=0,t[1]=0),t}()}();!function(){var t=function(){var t=new y(3);return y!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}()}();function T(t,e){if(!t)throw new Error(e||"@math.gl/web-mercator: assertion failed.")}var k=Math.PI,E=k/4,P=k/180,z=180/k;function O(t){return Math.pow(2,t)}function F(t){var e=p(t,2),r=e[0],n=e[1];T(Number.isFinite(r)),T(Number.isFinite(n)&&n>=-90&&n<=90,"invalid latitude");var i=n*P;return[512*(r*P+k)/(2*k),512*(k+Math.log(Math.tan(E+.5*i)))/(2*k)]}function N(t){var e=p(t,2),r=e[0],n=e[1],i=r/512*(2*k)-k,a=2*(Math.atan(Math.exp(n/512*(2*k)-k))-E);return[i*z,a*z]}function A(t){var e=t.latitude,r=t.longitude,n=t.highPrecision,i=void 0!==n&&n;T(Number.isFinite(e)&&Number.isFinite(r));var a={},o=Math.cos(e*P),u=512/360/o,s=512/4003e4/o;if(a.unitsPerMeter=[s,s,s],a.metersPerUnit=[1/s,1/s,1/s],a.unitsPerDegree=[512/360,u,s],a.degreesPerUnit=[.703125,1/u,1/s],i){var c=P*Math.tan(e*P)/o,l=512/360*c/2,h=512/4003e4*c,f=h/u*s;a.unitsPerDegree2=[0,l,h],a.unitsPerMeter2=[f,0,f]}return a}function C(t){var e=t.height,r=t.pitch,n=t.bearing,i=t.altitude,a=t.scale,o=t.center,u=void 0===o?null:o,s=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];return x(s,s,[0,0,-i]),function(t,e,r){var n=Math.sin(r),i=Math.cos(r),a=e[4],o=e[5],u=e[6],s=e[7],c=e[8],l=e[9],h=e[10],f=e[11];e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=a*i+c*n,t[5]=o*i+l*n,t[6]=u*i+h*n,t[7]=s*i+f*n,t[8]=c*i-a*n,t[9]=l*i-o*n,t[10]=h*i-u*n,t[11]=f*i-s*n}(s,s,-r*P),function(t,e,r){var n=Math.sin(r),i=Math.cos(r),a=e[0],o=e[1],u=e[2],s=e[3],c=e[4],l=e[5],h=e[6],f=e[7];e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=a*i+c*n,t[1]=o*i+l*n,t[2]=u*i+h*n,t[3]=s*i+f*n,t[4]=c*i-a*n,t[5]=l*i-o*n,t[6]=h*i-u*n,t[7]=f*i-s*n}(s,s,n*P),L(s,s,[a/=e,a,a]),u&&x(s,s,function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}([],u)),s}function I(t){var e=t.width,r=t.height,n=t.pitch,i=function(t){var e=t.width,r=t.height,n=t.altitude,i=void 0===n?1.5:n,a=t.pitch,o=void 0===a?0:a,u=t.nearZMultiplier,s=void 0===u?1:u,c=t.farZMultiplier,l=void 0===c?1:c,h=o*P,f=Math.atan(.5/i),d=Math.sin(f)*i/Math.sin(Math.PI/2-h-f);return{fov:2*f,aspect:e/r,focalDistance:i,near:s,far:(Math.cos(Math.PI/2-h)*d+i)*l}}({width:e,height:r,altitude:t.altitude,pitch:n,nearZMultiplier:t.nearZMultiplier,farZMultiplier:t.farZMultiplier});return function(t,e,r,n,i){var a,o=1/Math.tan(e/2);return t[0]=o/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=i&&i!==1/0?(a=1/(n-i),t[10]=(i+n)*a,t[14]=2*i*n*a):(t[10]=-1,t[14]=-2*n),t}([],i.fov,i.aspect,i.near,i.far)}function Z(t,e){var r=p(t,3),n=r[0],i=r[1],a=r[2],o=void 0===a?0:a;return T(Number.isFinite(n)&&Number.isFinite(i)&&Number.isFinite(o)),b(e,[n,i,o,1])}function U(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=p(t,3),i=n[0],a=n[1],o=n[2];if(T(Number.isFinite(i)&&Number.isFinite(a),"invalid pixel coordinate"),Number.isFinite(o)){var u=b(e,[i,a,o,1]);return u}var s=b(e,[i,a,0,1]),c=b(e,[i,a,1,1]),l=s[2],h=c[2],f=l===h?0:((r||0)-l)/(h-l);return S([],s,c,f)}var B=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];function D(t){var e=t.width,r=t.height,n=t.bounds,i=t.minExtent,a=void 0===i?0:i,o=t.maxZoom,u=void 0===o?24:o,s=t.padding,c=void 0===s?0:s,l=t.offset,h=void 0===l?[0,0]:l,f=p(n,2),d=p(f[0],2),v=d[0],y=d[1],m=p(f[1],2),g=m[0],b=m[1];if(Number.isFinite(c)){c={top:c,bottom:c,left:c,right:c}}else T(Number.isFinite(c.top)&&Number.isFinite(c.bottom)&&Number.isFinite(c.left)&&Number.isFinite(c.right));var w=new V({width:e,height:r,longitude:0,latitude:0,zoom:0}),M=w.project([v,b]),x=w.project([g,y]),L=[Math.max(Math.abs(x[0]-M[0]),a),Math.max(Math.abs(x[1]-M[1]),a)],_=[e-c.left-c.right-2*Math.abs(h[0]),r-c.top-c.bottom-2*Math.abs(h[1])];T(_[0]>0&&_[1]>0);var j=_[0]/L[0],S=_[1]/L[1],k=(c.right-c.left)/2/j,E=(c.bottom-c.top)/2/S,P=[(x[0]+M[0])/2+k,(x[1]+M[1])/2+E],z=w.unproject(P),O=Math.min(u,w.zoom+Math.log2(Math.abs(Math.min(j,S))));return T(Number.isFinite(O)),{longitude:z[0],latitude:z[1],zoom:O}}var V=function(t){function e(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=r.width,a=r.height,o=r.latitude,u=void 0===o?0:o,h=r.longitude,f=void 0===h?0:h,d=r.zoom,p=void 0===d?0:d,v=r.pitch,y=void 0===v?0:v,m=r.bearing,g=void 0===m?0:m,b=r.altitude,w=void 0===b?1.5:b,M=r.nearZMultiplier,x=void 0===M?.02:M,L=r.farZMultiplier,_=void 0===L?1.01:L;i(this,e),n=n||1,a=a||1;var j=O(p);w=Math.max(.75,w);var S=F([f,u]);S[2]=0;var T=I({width:n,height:a,pitch:y,bearing:g,altitude:w,nearZMultiplier:x,farZMultiplier:_}),k=C({height:a,scale:j,center:S,pitch:y,bearing:g,altitude:w});return(t=c(this,l(e).call(this,{width:n,height:a,scale:j,viewMatrix:k,projectionMatrix:T}))).latitude=u,t.longitude=f,t.zoom=p,t.pitch=y,t.bearing=g,t.altitude=w,t.center=S,t.unitsPerMeter=A(s(t)).unitsPerMeter[2],Object.freeze(s(t)),t}return f(e,t),o(e,[{key:"projectFlat",value:function(t){return F(t)}},{key:"unprojectFlat",value:function(t){return N(t)}},{key:"getMapCenterByLngLatPosition",value:function(t){var e=t.lngLat,r=U(t.pos,this.pixelUnprojectionMatrix),n=j([],F(e),function(t,e){return t[0]=-e[0],t[1]=-e[1],t}([],r));return N(j([],this.center,n),this.scale)}},{key:"getLocationAtPoint",value:function(t){var e=t.lngLat,r=t.pos;return this.getMapCenterByLngLatPosition({lngLat:e,pos:r})}},{key:"fitBounds",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this.width,i=this.height,a=D(Object.assign({width:n,height:i,bounds:t},r)),o=a.longitude,u=a.latitude,s=a.zoom;return new e({width:n,height:i,longitude:o,latitude:u,zoom:s})}}]),e}(function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=e.width,n=e.height,a=e.scale,o=e.viewMatrix,u=void 0===o?B:o,s=e.projectionMatrix,c=void 0===s?B:s;i(this,t),this.width=r||1,this.height=n||1,this.scale=a,this.unitsPerMeter=1,this.viewMatrix=u,this.projectionMatrix=c;var l=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];M(l,l,this.projectionMatrix),M(l,l,this.viewMatrix),this.viewProjectionMatrix=l;var h=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];L(h,h,[this.width/2,-this.height/2,1]),x(h,h,[1,-1,0]),M(h,h,this.viewProjectionMatrix);var f=w([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],h);if(!f)throw new Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=h,this.pixelUnprojectionMatrix=f,this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}return o(t,[{key:"equals",value:function(e){return e instanceof t&&(e.width===this.width&&e.height===this.height&&_(e.projectionMatrix,this.projectionMatrix)&&_(e.viewMatrix,this.viewMatrix))}},{key:"project",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e.topLeft,n=void 0===r||r,i=this.projectPosition(t),a=Z(i,this.pixelProjectionMatrix),o=p(a,2),u=o[0],s=o[1],c=n?s:this.height-s;return 2===t.length?[u,c]:[u,c,a[2]]}},{key:"unproject",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e.topLeft,n=void 0===r||r,i=e.targetZ,a=p(t,3),o=a[0],u=a[1],s=a[2],c=n?u:this.height-u,l=i&&i*this.unitsPerMeter,h=U([o,c,s],this.pixelUnprojectionMatrix,l),f=this.unprojectPosition(h),d=p(f,3),v=d[0],y=d[1],m=d[2];return Number.isFinite(s)?[v,y,m]:Number.isFinite(i)?[v,y,i]:[v,y]}},{key:"projectPosition",value:function(t){var e=p(this.projectFlat(t),2);return[e[0],e[1],(t[2]||0)*this.unitsPerMeter]}},{key:"unprojectPosition",value:function(t){var e=p(this.unprojectFlat(t),2);return[e[0],e[1],(t[2]||0)/this.unitsPerMeter]}},{key:"projectFlat",value:function(t){arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.scale;return t}},{key:"unprojectFlat",value:function(t){arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.scale;return t}}]),t}()),G={type:"url",value:"",validate:function(t){return"string"==typeof t||Array.isArray(t)&&t.every((function(t){return"string"==typeof t}))},equals:function(t,e){if(t===e)return!0;if(!Array.isArray(t)||!Array.isArray(e))return!1;var r=t.length;if(r!==e.length)return!1;for(var n=0;n<r;n++)if(t[n]!==e[n])return!1;return!0}};function q(t){var e=[t.unproject([0,0]),t.unproject([t.width,0]),t.unproject([0,t.height]),t.unproject([t.width,t.height])];return[Math.min(e[0][0],e[1][0],e[2][0],e[3][0]),Math.min(e[0][1],e[1][1],e[2][1],e[3][1]),Math.max(e[0][0],e[1][0],e[2][0],e[3][0]),Math.max(e[0][1],e[1][1],e[2][1],e[3][1])]}function R(t,e){var r=p(F(t),2),n=r[0],i=r[1];return[n*=e/512,i=(1-i/512)*e]}function J(t,e){var r=p(t,2);return[r[0]*e/512,r[1]*e/512]}function Y(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:512;return 512*Math.pow(2,t)/e}function $(t,e,r){var n=Y(r),i=t/n*360-180,a=Math.PI-2*Math.PI*e/n;return[i,180/Math.PI*Math.atan(.5*(Math.exp(a)-Math.exp(-a)))]}function H(t,e,r,n){var i=Y(r,n);return[t/i*512,e/i*512]}function K(t,e,r,n){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:512;if(t.isGeospatial){var a=$(e,r,n),o=p(a,2),u=o[0],s=o[1],c=$(e+1,r+1,n),l=p(c,2),h=l[0],f=l[1];return{west:u,north:s,east:h,south:f}}var d=H(e,r,n,i),v=p(d,2),y=v[0],m=v[1],g=H(e+1,r+1,n,i),b=p(g,2),w=b[0],M=b[1];return{left:y,top:m,right:w,bottom:M}}function Q(t,e,r){for(var n=q(t),i=Y(e,r),a=p(J([n[0],n[1]],i),2),o=a[0],u=a[1],s=p(J([n[2],n[3]],i),2),c=s[0],l=s[1],h=[],f=Math.floor(o);f<c;f++)for(var d=Math.floor(u);d<l;d++)h.push({x:f,y:d,z:e});return h}function W(t,e){var r=q(t),n=Y(e),i=p(R([r[0],r[3]],n),2),a=i[0],o=i[1],u=p(R([r[2],r[1]],n),2),s=u[0],c=u[1],l=[];a=Math.floor(a),s=Math.min(a+n,s),o=Math.max(0,Math.floor(o)),c=Math.min(n,c);for(var h=a;h<s;h++)for(var f=o;f<c;f++){var d=h-Math.floor(h/n)*n;l.push({x:d,y:f,z:e})}return l}var X=function(){function t(e){var r=this;i(this,t),this.opts=e,this._getTileData=e.getTileData,this.onTileError=e.onTileError,this.onTileLoad=function(t){e.onTileLoad(t),r.opts.maxCacheByteSize&&(r._cacheByteSize+=t.byteLength,r._resizeCache())},this._cache=new Map,this._tiles=[],this._dirty=!1,this._cacheByteSize=0,this._viewport=null,this._selectedTiles=null,this._frameNumber=0,this.setOptions(e)}return o(t,[{key:"setOptions",value:function(t){Object.assign(this.opts,t),Number.isFinite(t.maxZoom)&&(this._maxZoom=Math.floor(t.maxZoom)),Number.isFinite(t.minZoom)&&(this._minZoom=Math.ceil(t.minZoom))}},{key:"update",value:function(t){var e=this;if(t!==this._viewport){this._viewport=t;var r=this.getTileIndices({viewport:t,maxZoom:this._maxZoom,minZoom:this._minZoom});this._selectedTiles=r.map((function(t){return e._getTile(t,!0)})),this._dirty&&this._rebuildTree()}var n=this.updateTileStates();return this._dirty&&this._resizeCache(),n&&this._frameNumber++,this._frameNumber}},{key:"getTileIndices",value:function(t){return function(t,e,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:512,i=Math.ceil(t.zoom);return Number.isFinite(r)&&i<r?[]:(Number.isFinite(e)&&i>e&&(i=e),t.isGeospatial?W(t,i):Q(t,i,n))}(t.viewport,t.maxZoom,t.minZoom,this.opts.tileSize)}},{key:"getTileMetadata",value:function(t){var e=t.x,r=t.y,n=t.z;return{bbox:K(this._viewport,e,r,n,this.opts.tileSize)}}},{key:"getParentIndex",value:function(t){return t.x=Math.floor(t.x/2),t.y=Math.floor(t.y/2),t.z-=1,t}},{key:"updateTileStates",value:function(){this._updateTileStates(this.selectedTiles);var t=!1,e=!0,r=!1,n=void 0;try{for(var i,a=this._cache.values()[Symbol.iterator]();!(e=(i=a.next()).done);e=!0){var o=i.value,u=Boolean(1&o.state);o.isVisible!==u&&(t=!0,o.isVisible=u)}}catch(t){r=!0,n=t}finally{try{e||null==a.return||a.return()}finally{if(r)throw n}}return t}},{key:"_rebuildTree",value:function(){var t=this._cache,e=!0,r=!1,n=void 0;try{for(var i,a=t.values()[Symbol.iterator]();!(e=(i=a.next()).done);e=!0){var o=i.value;o.parent=null,o.children.length=0}}catch(t){r=!0,n=t}finally{try{e||null==a.return||a.return()}finally{if(r)throw n}}var u=!0,s=!1,c=void 0;try{for(var l,h=t.values()[Symbol.iterator]();!(u=(l=h.next()).done);u=!0){var f=l.value,d=this._getNearestAncestor(f.x,f.y,f.z);f.parent=d,d&&d.children.push(f)}}catch(t){s=!0,c=t}finally{try{u||null==h.return||h.return()}finally{if(s)throw c}}}},{key:"_updateTileStates",value:function(t){var e=this._cache,r=this.opts.refinementStrategy||"best-available",n=!0,i=!1,a=void 0;try{for(var o,u=e.values()[Symbol.iterator]();!(n=(o=u.next()).done);n=!0){o.value.state=0}}catch(t){i=!0,a=t}finally{try{n||null==u.return||u.return()}finally{if(i)throw a}}var s=!0,c=!1,l=void 0;try{for(var h,f=t[Symbol.iterator]();!(s=(h=f.next()).done);s=!0){h.value.state=5}}catch(t){c=!0,l=t}finally{try{s||null==f.return||f.return()}finally{if(c)throw l}}if("never"!==r){var d=!0,p=!1,v=void 0;try{for(var y,m=t[Symbol.iterator]();!(d=(y=m.next()).done);d=!0){et(y.value,r)}}catch(t){p=!0,v=t}finally{try{d||null==m.return||m.return()}finally{if(p)throw v}}var g=!0,b=!1,w=void 0;try{for(var M,x=t[Symbol.iterator]();!(g=(M=x.next()).done);g=!0){var L=M.value;tt(L)&&rt(L)}}catch(t){b=!0,w=t}finally{try{g||null==x.return||x.return()}finally{if(b)throw w}}}}},{key:"_resizeCache",value:function(){var t=this._cache,e=this.opts,r=e.maxCacheSize||(e.maxCacheByteSize?1/0:5*this.selectedTiles.length),n=e.maxCacheByteSize||1/0;if(t.size>r||this._cacheByteSize>n){var i=!0,a=!1,o=void 0;try{for(var u,s=t[Symbol.iterator]();!(i=(u=s.next()).done);i=!0){var c=p(u.value,2),l=c[0],h=c[1];if(h.isVisible||(this._cacheByteSize-=e.maxCacheByteSize?h.byteLength:0,t.delete(l)),t.size<=r&&this._cacheByteSize<=n)break}}catch(t){a=!0,o=t}finally{try{i||null==s.return||s.return()}finally{if(a)throw o}}this._rebuildTree(),this._dirty=!0}this._dirty&&(this._tiles=Array.from(this._cache.values()).sort((function(t,e){return t.z-e.z})),this._dirty=!1)}},{key:"_getTile",value:function(t,e){var r=t.x,n=t.y,i=t.z,a="".concat(r,",").concat(n,",").concat(i),o=this._cache.get(a);return!o&&e&&(o=new v({x:r,y:n,z:i,onTileLoad:this.onTileLoad,onTileError:this.onTileError}),Object.assign(o,this.getTileMetadata(o)),o.loadData(this._getTileData),this._cache.set(a,o),this._dirty=!0),o}},{key:"_getNearestAncestor",value:function(t,e,r){for(var n=this._minZoom,i=void 0===n?0:n,a={x:t,y:e,z:r};a.z>i;){a=this.getParentIndex(a);var o=this._getTile(a);if(o)return o}return null}},{key:"tiles",get:function(){return this._tiles}},{key:"selectedTiles",get:function(){return this._selectedTiles}},{key:"isLoaded",get:function(){return this._selectedTiles.every((function(t){return t.isLoaded}))}}]),t}();function tt(t){for(var e=t;e;){if(!1&e.state)return!0;if(e.isLoaded)return!1;e=e.parent}return!0}function et(t,e){for(var r,n=3;r=t.parent;){if(t.isLoaded&&(n=4,"best-available"===e))return;r.state=Math.max(r.state,n),t=r}}function rt(t){var e=!0,r=!1,n=void 0;try{for(var i,a=t.children[Symbol.iterator]();!(e=(i=a.next()).done);e=!0){var o=i.value;o.state=Math.max(o.state,3),o.isLoaded||rt(o)}}catch(t){r=!0,n=t}finally{try{e||null==a.return||a.return()}finally{if(r)throw n}}}var nt={data:[],dataComparator:G.equals,renderSubLayers:{type:"function",value:function(t){return new e.GeoJsonLayer(t)},compare:!1},getTileData:{type:"function",optional:!0,value:null,compare:!1},onViewportLoad:{type:"function",optional:!0,value:null,compare:!1},onTileLoad:{type:"function",value:function(t){},compare:!1},onTileError:{type:"function",value:function(t){return console.error(t)},compare:!1},tileSize:512,maxZoom:null,minZoom:0,maxCacheSize:null,maxCacheByteSize:null,refinementStrategy:"best-available"},it=function(e){function r(){return i(this,r),c(this,l(r).apply(this,arguments))}return f(r,e),o(r,[{key:"initializeState",value:function(){this.state={tiles:[],isLoaded:!1}}},{key:"shouldUpdateState",value:function(t){return t.changeFlags.somethingChanged}},{key:"updateState",value:function(t){var e=t.props,r=(t.oldProps,t.context,t.changeFlags),n=this.state.tileset,i=!n||r.dataChanged||r.updateTriggersChanged&&(r.updateTriggersChanged.all||r.updateTriggersChanged.getTileData);if(i){var a=e.maxZoom,o=e.minZoom,u=e.tileSize,s=e.maxCacheSize,c=e.maxCacheByteSize,l=e.refinementStrategy;n=new X({getTileData:this.getTileData.bind(this),maxCacheSize:s,maxCacheByteSize:c,maxZoom:a,minZoom:o,tileSize:u,refinementStrategy:l,onTileLoad:this._onTileLoad.bind(this),onTileError:this._onTileError.bind(this)}),this.setState({tileset:n})}else r.propsChanged&&(n.setOptions(e),this.state.tileset.tiles.forEach((function(t){t.layers=null})));(i||r.viewportChanged)&&this._updateTileset()}},{key:"_updateTileset",value:function(){var t=this.state.tileset,e=this.props.onViewportLoad,r=t.update(this.context.viewport),n=t.isLoaded,i=this.state.isLoaded!==n,a=this.state.frameNumber!==r;n&&e&&(i||a)&&e(t.selectedTiles.map((function(t){return t.data}))),a&&this.setState({frameNumber:r}),this.state.isLoaded=n}},{key:"_onTileLoad",value:function(t){var e=this.getCurrentLayer();e.props.onTileLoad(t),e._updateTileset()}},{key:"_onTileError",value:function(t){var e=this.getCurrentLayer();e.props.onTileError(t),e._updateTileset()}},{key:"getTileData",value:function(t){var e,r,n=this.props,i=n.getTileData,a=n.fetch,o=n.data;return t.url=(r=t,(e=o)&&e.length?(Array.isArray(e)&&(e=e[Math.abs(r.x+r.y)%e.length]),e.replace(/\{ *([\w_-]+) *\}/g,(function(t,e){return r[e]}))):null),i?i(t):t.url?a(t.url,{layer:this}):null}},{key:"renderSubLayers",value:function(t){return this.props.renderSubLayers(t)}},{key:"getPickingInfo",value:function(t){var e=t.info,r=t.sourceLayer;return e.sourceLayer=r,e.tile=r.props.tile,e}},{key:"renderLayers",value:function(){var e=this,r=this.props.visible;return this.state.tileset.tiles.map((function(n){var i=r&&n.isVisible;if(n.layers)n.layers[0]&&n.layers[0].props.visible!==i&&(n.layers=n.layers.map((function(t){return t.clone({visible:i})})));else{var a=e.renderSubLayers(Object.assign({},e.props,{id:"".concat(e.id,"-").concat(n.x,"-").concat(n.y,"-").concat(n.z),data:n.data,visible:i,_offset:0,tile:n}));n.layers=t._flatten(a,Boolean)}return n.layers}))}},{key:"isLoaded",get:function(){return this.state.tileset.selectedTiles.every((function(t){return t.layers&&t.layers.every((function(t){return t.isLoaded}))}))}}]),r}(t.CompositeLayer);it.layerName="TileLayer",it.defaultProps=nt;var at=function(t,e){return t(e={exports:{}},e.exports),e.exports}((function(t){var e=function(t){var e=Object.prototype,r=e.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},i=n.iterator||"@@iterator",a=n.asyncIterator||"@@asyncIterator",o=n.toStringTag||"@@toStringTag";function u(t,e,r,n){var i=e&&e.prototype instanceof l?e:l,a=Object.create(i.prototype),o=new x(n||[]);return a._invoke=function(t,e,r){var n="suspendedStart";return function(i,a){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===i)throw a;return _()}for(r.method=i,r.arg=a;;){var o=r.delegate;if(o){var u=b(o,r);if(u){if(u===c)continue;return u}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var l=s(t,e,r);if("normal"===l.type){if(n=r.done?"completed":"suspendedYield",l.arg===c)continue;return{value:l.arg,done:r.done}}"throw"===l.type&&(n="completed",r.method="throw",r.arg=l.arg)}}}(t,r,o),a}function s(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=u;var c={};function l(){}function h(){}function f(){}var d={};d[i]=function(){return this};var p=Object.getPrototypeOf,v=p&&p(p(L([])));v&&v!==e&&r.call(v,i)&&(d=v);var y=f.prototype=l.prototype=Object.create(d);function m(t){["next","throw","return"].forEach((function(e){t[e]=function(t){return this._invoke(e,t)}}))}function g(t,e){var n;this._invoke=function(i,a){function o(){return new e((function(n,o){!function n(i,a,o,u){var c=s(t[i],t,a);if("throw"!==c.type){var l=c.arg,h=l.value;return h&&"object"==typeof h&&r.call(h,"__await")?e.resolve(h.__await).then((function(t){n("next",t,o,u)}),(function(t){n("throw",t,o,u)})):e.resolve(h).then((function(t){l.value=t,o(l)}),(function(t){return n("throw",t,o,u)}))}u(c.arg)}(i,a,n,o)}))}return n=n?n.then(o,o):o()}}function b(t,e){var r=t.iterator[e.method];if(void 0===r){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,b(t,e),"throw"===e.method))return c;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return c}var n=s(r,t.iterator,e.arg);if("throw"===n.type)return e.method="throw",e.arg=n.arg,e.delegate=null,c;var i=n.arg;return i?i.done?(e[t.resultName]=i.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,c):i:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,c)}function w(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function M(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function x(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(w,this),this.reset(!0)}function L(t){if(t){var e=t[i];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,a=function e(){for(;++n<t.length;)if(r.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=void 0,e.done=!0,e};return a.next=a}}return{next:_}}function _(){return{value:void 0,done:!0}}return h.prototype=y.constructor=f,f.constructor=h,f[o]=h.displayName="GeneratorFunction",t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===h||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,f):(t.__proto__=f,o in t||(t[o]="GeneratorFunction")),t.prototype=Object.create(y),t},t.awrap=function(t){return{__await:t}},m(g.prototype),g.prototype[a]=function(){return this},t.AsyncIterator=g,t.async=function(e,r,n,i,a){void 0===a&&(a=Promise);var o=new g(u(e,r,n,i),a);return t.isGeneratorFunction(r)?o:o.next().then((function(t){return t.done?t.value:o.next()}))},m(y),y[o]="Generator",y[i]=function(){return this},y.toString=function(){return"[object Generator]"},t.keys=function(t){var e=[];for(var r in t)e.push(r);return e.reverse(),function r(){for(;e.length;){var n=e.pop();if(n in t)return r.value=n,r.done=!1,r}return r.done=!0,r}},t.values=L,x.prototype={constructor:x,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(M),!t)for(var e in this)"t"===e.charAt(0)&&r.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(r,n){return o.type="throw",o.arg=t,e.next=r,n&&(e.method="next",e.arg=void 0),!!n}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],o=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var u=r.call(a,"catchLoc"),s=r.call(a,"finallyLoc");if(u&&s){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var a=i;break}}a&&("break"===t||"continue"===t)&&a.tryLoc<=e&&e<=a.finallyLoc&&(a=null);var o=a?a.completion:{};return o.type=t,o.arg=e,a?(this.method="next",this.next=a.finallyLoc,c):this.complete(o)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),c},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),M(r),c}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var i=n.arg;M(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:L(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),c}},t}(t.exports);try{regeneratorRuntime=e}catch(t){Function("r","regeneratorRuntime = r")(e)}}));function ot(t,e,r,n,i,a,o){try{var u=t[a](o),s=u.value}catch(t){return void r(t)}u.done?e(s):Promise.resolve(s).then(n,i)}function ut(t){return function(){var e=this,r=arguments;return new Promise((function(n,i){var a=t.apply(e,r);function o(t){ot(a,n,i,o,u,"next",t)}function u(t){ot(a,n,i,o,u,"throw",t)}o(void 0)}))}}!function(){async function t(t){return await new Promise((e,r)=>this.getMap(t,(t,n)=>{n?r(n):e(t)}))}n.Image.prototype.getMapAsync=t,n.ImageCollection.prototype.getMapAsync=t}();class st{constructor(){this.ee=n}async initialize({clientId:t,token:e}){e?this.setToken(e):await this.authenticateViaOAuth(t),await this._initialize()}async authenticateViaOAuth(t,e=null){return await new Promise((r,i)=>{n.data.authenticateViaOauth(t,t=>r(t),t=>i(t),e,t=>{n.data.authenticateViaPopup(r,i)})})}setToken(t){t&&n.apiclient.setAuthToken("","Bearer",t,3600,[],void 0,!1)}async _initialize(t=null,e=null){return window.ee=n,await new Promise((r,i)=>{n.initialize(t,e,t=>r(t),t=>i(t))})}}function ct(t,e){if(!t)throw new Error(e)}var lt={self:"undefined"!=typeof self&&self,window:"undefined"!=typeof window&&window,global:"undefined"!=typeof global&&global,document:"undefined"!=typeof document&&document},ht=lt.global||lt.self||lt.window,ft="object"!==("undefined"==typeof process?"undefined":u(process))||"[object process]"!==String(process)||process.browser,dt="undefined"!=typeof process&&process.version&&process.version.match(/v([0-9]*)/),pt=(dt&&parseFloat(dt[1]),ht._parseImageNode),vt="undefined"!=typeof Image,yt="undefined"!=typeof ImageBitmap,mt=Boolean(pt);function gt(t){switch(t){case"auto":return yt||vt||mt;case"imagebitmap":return yt;case"html":case"image":return vt;case"ndarray":case"data":return!!ft||mt;default:throw new Error("@loaders.gl/images: image ".concat(t," not supported in this environment"))}}function bt(t){var e=function(t){if("undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap)return"imagebitmap";if("undefined"!=typeof Image&&t instanceof Image)return"image";if(t&&"object"===u(t)&&t.data&&t.width&&t.height)return"data";return null}(t);if(!e)throw new Error("Not an image");return e}function wt(t){switch(bt(t)){case"data":return t;case"image":case"imagebitmap":var e=document.createElement("canvas"),r=e.getContext("2d");return e.width=t.width,e.height=t.height,r.drawImage(t,0,0),r.getImageData(0,0,t.width,t.height);default:return ct(!1)}}var Mt=/^data:image\/svg\+xml/,xt=/\.svg((\?|#).*)?$/;function Lt(t,e){return jt(e)?(console.warn("SVG cannot be parsed to imagebitmap"),new Blob([new Uint8Array(t)],{type:"image/svg+xml"})):new Blob([new Uint8Array(t)])}function _t(t,e){if(jt(e)){var r=(new TextDecoder).decode(t);return"data:image/svg+xml;base64,".concat(btoa(r))}return Lt(t,e)}function jt(t){return t&&(Mt.test(t)||xt.test(t))}function St(t,e,r){return Tt.apply(this,arguments)}function Tt(){return(Tt=ut(at.mark((function t(e,r,n){var i,a,o;return at.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=_t(e,n),a=self.URL||self.webkitURL,o="string"!=typeof i&&a.createObjectURL(i),t.prev=3,t.next=6,kt(o||i,r);case 6:return t.abrupt("return",t.sent);case 7:return t.prev=7,o&&a.revokeObjectURL(o),t.finish(7);case 10:case"end":return t.stop()}}),t,null,[[3,,7,10]])})))).apply(this,arguments)}function kt(t,e){return Et.apply(this,arguments)}function Et(){return(Et=ut(at.mark((function t(e,r){var n;return at.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if((n=new Image).src=e,!(r.image&&r.image.decode&&n.decode)){t.next=6;break}return t.next=5,n.decode();case 5:return t.abrupt("return",n);case 6:return t.next=8,new Promise((function(t,r){try{n.onload=function(){return t(n)},n.onerror=function(t){return r(new Error("Could not load image ".concat(e,": ").concat(t)))}}catch(t){r(t)}}));case 8:return t.abrupt("return",t.sent);case 9:case"end":return t.stop()}}),t)})))).apply(this,arguments)}var Pt=!0;function zt(t,e,r){return Ot.apply(this,arguments)}function Ot(){return(Ot=ut(at.mark((function t(e,r,n){var i,a;return at.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i=Lt(e,n),!Nt(a=r&&r.imagebitmap)&&Pt||(a=null),!a){t.next=14;break}return t.prev=4,t.next=7,createImageBitmap(i,a);case 7:return t.abrupt("return",t.sent);case 10:t.prev=10,t.t0=t.catch(4),console.warn(t.t0),Pt=!1;case 14:return t.next=16,createImageBitmap(i);case 16:return t.abrupt("return",t.sent);case 17:case"end":return t.stop()}}),t,null,[[4,10]])})))).apply(this,arguments)}var Ft={};function Nt(t){for(var e in t||Ft)return!0;return!1}var At=new Map([["image/png",{test:Ct,getSize:function(t){return{width:t.getUint32(16,!1),height:t.getUint32(20,!1)}}}],["image/jpeg",{test:Ut,getSize:function(t){if(t.byteLength<2||65496!==t.getUint16(0,!1))return null;var e=function(){for(var t=new Set([65499,65476,65484,65501,65534]),e=65504;e<65520;++e)t.add(e);var r=new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502]);return{tableMarkers:t,sofMarkers:r}}(),r=e.tableMarkers,n=e.sofMarkers,i=2;for(;i<t.byteLength;){var a=t.getUint16(i,!1);if(n.has(a))return{height:t.getUint16(i+5,!1),width:t.getUint16(i+7,!1)};if(!r.has(a))return null;i+=2,i+=t.getUint16(i,!1)}return null}}],["image/gif",{test:It,getSize:function(t){return{width:t.getUint16(6,!0),height:t.getUint16(8,!0)}}}],["image/bmp",{test:Zt,getSize:function(t){return{width:t.getUint32(18,!0),height:t.getUint32(22,!0)}}}]]);function Ct(t){return t.byteLength>=24&&2303741511===t.getUint32(0,!1)}function It(t){return t.byteLength>=10&&1195984440===t.getUint32(0,!1)}function Zt(t){return t.byteLength>=14&&16973===t.getUint16(0,!1)&&t.getUint32(2,!0)===t.byteLength}function Ut(t){return t.byteLength>=3&&65496===t.getUint16(0,!1)&&255===t.getUint8(2,!1)}"Invalid MIME type. Supported MIME types are: ".concat(Array.from(At.keys()).join(", "));function Bt(t){var e=function(t){if((t=t.buffer||t)instanceof ArrayBuffer)return new DataView(t);if(ArrayBuffer.isView(t))return new DataView(t.buffer);throw new Error("toDataView")}(t),r=!0,n=!1,i=void 0;try{for(var a,o=At.entries()[Symbol.iterator]();!(r=(a=o.next()).done);r=!0){var u=p(a.value,2),s=u[0];if((0,u[1].test)(e))return s}}catch(t){n=!0,i=t}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}return null}function Dt(t,e){var r=Bt(t),n=ht._parseImageNode;return ct(n),n(t,r,e)}function Vt(){return(Vt=ut(at.mark((function t(e,r,n){var i,a,o,u,s;return at.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:i=(r=r||{}).image||{},a=i.type||"auto",o=(n||{}).url,u=Gt(a),t.t0=u,t.next="imagebitmap"===t.t0?8:"image"===t.t0?12:"data"===t.t0?16:20;break;case 8:return t.next=10,zt(e,r,o);case 10:return s=t.sent,t.abrupt("break",21);case 12:return t.next=14,St(e,r,o);case 14:return s=t.sent,t.abrupt("break",21);case 16:return t.next=18,Dt(e,r);case 18:return s=t.sent,t.abrupt("break",21);case 20:ct(!1);case 21:return"data"===a&&(s=wt(s)),t.abrupt("return",s);case 23:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function Gt(t){switch(t){case"auto":case"data":return function(){if(gt("image"))return"image";if(gt("imagebitmap"))return"imagebitmap";if(gt("data"))return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}();default:return gt(t),t}}var qt={name:"Images",version:"2.1.4",mimeTypes:["image/png","image/jpeg","image/gif","image/webp","image/bmp","image/vndmicrosofticon","image/svg+xml"],extensions:["png","jpg","jpeg","gif","webp","bmp","ico","svg"],parse:function(t,e,r){return Vt.apply(this,arguments)},test:function(t){var e=new DataView(t);return Ut(e)||Zt(e)||It(e)||Ct(e)},options:{image:{format:"auto",decode:!0}}};let Rt,Jt;const Yt={...it.defaultProps,data:{type:"object",value:null},token:{type:"string",value:null},eeObject:{type:"object",value:null},visParams:{type:"object",value:null,equal:function t(e,r){if(e===r)return!0;if(!e||!r)return!1;for(const n in e){const i=e[n],a=r[n];if(!(i===a||Array.isArray(i)&&Array.isArray(a)&&t(i,a)))return!1}return!0}},refinementStrategy:"no-overlap"};class $t extends t.CompositeLayer{initializeState(){this.state={}}async updateState({props:t,oldProps:e,changeFlags:r}){await this._updateToken(t,e,r),this._updateEEObject(t,e,r),await this._updateEEVisParams(t,e,r)}async _updateToken(t,e,r){if(!t.token||t.token===Jt)return;const{token:n}=t;Rt=Rt||new st,await Rt.initialize({token:n}),Jt=n}_updateEEObject(t,e,r){if(!r.dataChanged)return;let i;i="string"==typeof t.eeObject?n.Deserializer.fromJSON(t.eeObject):t.eeObject,Array.isArray(t.eeObject)&&0===t.eeObject.length&&(i=null),this.setState({eeObject:i})}async _updateEEVisParams(t,e,r){if(t.visParams===e.visParams&&!r.dataChanged)return;const{eeObject:n}=this.state;if(!n)return;if(!n.getMap)throw new Error("EarthEngineLayer only accepts data rows that are EE Objects with a getMap() method");const i=await n.getMapAsync(t.visParams),a=i.formatTileUrl.bind(i);this.setState({map:i,getTileUrl:a})}renderLayers(){const{getTileUrl:t}=this.state,{refinementStrategy:n,onViewportLoad:i,onTileLoad:a,onTileError:o,maxZoom:u,minZoom:s,maxCacheSize:c,maxCacheByteSize:l}=this.props;return t&&new it(this.getSubLayerProps({id:t(0,0,0)}),{refinementStrategy:n,onViewportLoad:i,onTileLoad:a,onTileError:o,maxZoom:u,minZoom:s,maxCacheSize:c,maxCacheByteSize:l,async getTileData({x:e,y:n,z:i}){const a=t(e,n,i);return await r.load(a,qt)},renderSubLayers(t){const{data:r,tile:n}=t,{west:i,south:a,east:o,north:u}=n.bbox,s=[i,a,o,u];return r&&[new e.BitmapLayer(Object.assign(t,{image:r,bounds:s}))]}})}}$t.layerName="EarthEngineLayer",$t.defaultProps=Yt;const Ht={EarthEngineLayer:$t};return("undefined"==typeof window?global:window).EarthEngineLayerLibrary=Ht,Ht}(deck,deck,loaders,ee);
