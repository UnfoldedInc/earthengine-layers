var EarthEngineLayerLibrary=function(t,e,r,n){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function o(t,e,r){return e&&a(t.prototype,e),r&&a(t,r),t}function s(t){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function u(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function h(t,e){return!e||"object"!==s(e)&&"function"!=typeof e?u(t):e}function c(t){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function l(t,e,r){return(l="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=c(t)););return t}(t,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(r):i.value}})(t,e,r||t)}function f(t,e){return(f=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function d(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&f(t,e)}function p(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function v(t,e){if(t){if("string"==typeof t)return p(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(r):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?p(t,e):void 0}}function y(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t)){var r=[],n=!0,i=!1,a=void 0;try{for(var o,s=t[Symbol.iterator]();!(n=(o=s.next()).done)&&(r.push(o.value),!e||r.length!==e);n=!0);}catch(t){i=!0,a=t}finally{try{n||null==s.return||s.return()}finally{if(i)throw a}}return r}}(t,e)||v(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}n=n&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n;var m=function(){function e(t){var r=t.x,n=t.y,a=t.z,o=t.onTileLoad,s=t.onTileError;i(this,e),this.x=r,this.y=n,this.z=a,this.isVisible=!1,this.parent=null,this.children=[],this.content=null,this._isLoaded=!1,this.onTileLoad=o,this.onTileError=s}return o(e,[{key:"loadData",value:function(t){var e=this,r=this.x,n=this.y,i=this.z,a=this.bbox;t&&(this._loader=Promise.resolve(t({x:r,y:n,z:i,bbox:a})).then((function(t){return e.content=t,e._isLoaded=!0,e.onTileLoad(e),t})).catch((function(t){e._isLoaded=!0,e.onTileError(t)})))}},{key:"data",get:function(){return this._isLoaded?this.content:this._loader}},{key:"isLoaded",get:function(){return this._isLoaded}},{key:"byteLength",get:function(){var e=this.content?this.content.byteLength:0;return Number.isFinite(e)||t.log.error("byteLength not defined in tile data")(),e}}]),e}(),b="undefined"!=typeof Float32Array?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var g,w;g=new b(4),b!=Float32Array&&(g[0]=0,g[1]=0,g[2]=0,g[3]=0),w=g;function x(t,e){var r=function(t,e,r){var n=e[0],i=e[1],a=e[2],o=e[3];return t[0]=r[0]*n+r[4]*i+r[8]*a+r[12]*o,t[1]=r[1]*n+r[5]*i+r[9]*a+r[13]*o,t[2]=r[2]*n+r[6]*i+r[10]*a+r[14]*o,t[3]=r[3]*n+r[7]*i+r[11]*a+r[15]*o,t}([],e,t);return function(t,e,r){t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r}(r,r,1/r[3]),r}function M(t,e){var r=e[0],n=e[1],i=e[2],a=e[3],o=e[4],s=e[5],u=e[6],h=e[7],c=e[8],l=e[9],f=e[10],d=e[11],p=e[12],v=e[13],y=e[14],m=e[15],b=r*s-n*o,g=r*u-i*o,w=r*h-a*o,x=n*u-i*s,M=n*h-a*s,L=i*h-a*u,S=c*v-l*p,k=c*y-f*p,E=c*m-d*p,_=l*y-f*v,j=l*m-d*v,T=f*m-d*y,O=b*T-g*j+w*_+x*E-M*k+L*S;return O?(O=1/O,t[0]=(s*T-u*j+h*_)*O,t[1]=(i*j-n*T-a*_)*O,t[2]=(v*L-y*M+m*x)*O,t[3]=(f*M-l*L-d*x)*O,t[4]=(u*E-o*T-h*k)*O,t[5]=(r*T-i*E+a*k)*O,t[6]=(y*w-p*L-m*g)*O,t[7]=(c*L-f*w+d*g)*O,t[8]=(o*j-s*E+h*S)*O,t[9]=(n*E-r*j-a*S)*O,t[10]=(p*M-v*w+m*b)*O,t[11]=(l*w-c*M-d*b)*O,t[12]=(s*k-o*_-u*S)*O,t[13]=(r*_-n*k+i*S)*O,t[14]=(v*g-p*x-y*b)*O,t[15]=(c*x-l*g+f*b)*O,t):null}function L(t,e,r){var n=e[0],i=e[1],a=e[2],o=e[3],s=e[4],u=e[5],h=e[6],c=e[7],l=e[8],f=e[9],d=e[10],p=e[11],v=e[12],y=e[13],m=e[14],b=e[15],g=r[0],w=r[1],x=r[2],M=r[3];return t[0]=g*n+w*s+x*l+M*v,t[1]=g*i+w*u+x*f+M*y,t[2]=g*a+w*h+x*d+M*m,t[3]=g*o+w*c+x*p+M*b,g=r[4],w=r[5],x=r[6],M=r[7],t[4]=g*n+w*s+x*l+M*v,t[5]=g*i+w*u+x*f+M*y,t[6]=g*a+w*h+x*d+M*m,t[7]=g*o+w*c+x*p+M*b,g=r[8],w=r[9],x=r[10],M=r[11],t[8]=g*n+w*s+x*l+M*v,t[9]=g*i+w*u+x*f+M*y,t[10]=g*a+w*h+x*d+M*m,t[11]=g*o+w*c+x*p+M*b,g=r[12],w=r[13],x=r[14],M=r[15],t[12]=g*n+w*s+x*l+M*v,t[13]=g*i+w*u+x*f+M*y,t[14]=g*a+w*h+x*d+M*m,t[15]=g*o+w*c+x*p+M*b,t}function S(t,e,r){var n,i,a,o,s,u,h,c,l,f,d,p,v=r[0],y=r[1],m=r[2];return e===t?(t[12]=e[0]*v+e[4]*y+e[8]*m+e[12],t[13]=e[1]*v+e[5]*y+e[9]*m+e[13],t[14]=e[2]*v+e[6]*y+e[10]*m+e[14],t[15]=e[3]*v+e[7]*y+e[11]*m+e[15]):(n=e[0],i=e[1],a=e[2],o=e[3],s=e[4],u=e[5],h=e[6],c=e[7],l=e[8],f=e[9],d=e[10],p=e[11],t[0]=n,t[1]=i,t[2]=a,t[3]=o,t[4]=s,t[5]=u,t[6]=h,t[7]=c,t[8]=l,t[9]=f,t[10]=d,t[11]=p,t[12]=n*v+s*y+l*m+e[12],t[13]=i*v+u*y+f*m+e[13],t[14]=a*v+h*y+d*m+e[14],t[15]=o*v+c*y+p*m+e[15]),t}function k(t,e,r){var n=r[0],i=r[1],a=r[2];return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*a,t[9]=e[9]*a,t[10]=e[10]*a,t[11]=e[11]*a,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function E(t,e){var r=t[0],n=t[1],i=t[2],a=t[3],o=t[4],s=t[5],u=t[6],h=t[7],c=t[8],l=t[9],f=t[10],d=t[11],p=t[12],v=t[13],y=t[14],m=t[15],b=e[0],g=e[1],w=e[2],x=e[3],M=e[4],L=e[5],S=e[6],k=e[7],E=e[8],_=e[9],j=e[10],T=e[11],O=e[12],N=e[13],A=e[14],P=e[15];return Math.abs(r-b)<=1e-6*Math.max(1,Math.abs(r),Math.abs(b))&&Math.abs(n-g)<=1e-6*Math.max(1,Math.abs(n),Math.abs(g))&&Math.abs(i-w)<=1e-6*Math.max(1,Math.abs(i),Math.abs(w))&&Math.abs(a-x)<=1e-6*Math.max(1,Math.abs(a),Math.abs(x))&&Math.abs(o-M)<=1e-6*Math.max(1,Math.abs(o),Math.abs(M))&&Math.abs(s-L)<=1e-6*Math.max(1,Math.abs(s),Math.abs(L))&&Math.abs(u-S)<=1e-6*Math.max(1,Math.abs(u),Math.abs(S))&&Math.abs(h-k)<=1e-6*Math.max(1,Math.abs(h),Math.abs(k))&&Math.abs(c-E)<=1e-6*Math.max(1,Math.abs(c),Math.abs(E))&&Math.abs(l-_)<=1e-6*Math.max(1,Math.abs(l),Math.abs(_))&&Math.abs(f-j)<=1e-6*Math.max(1,Math.abs(f),Math.abs(j))&&Math.abs(d-T)<=1e-6*Math.max(1,Math.abs(d),Math.abs(T))&&Math.abs(p-O)<=1e-6*Math.max(1,Math.abs(p),Math.abs(O))&&Math.abs(v-N)<=1e-6*Math.max(1,Math.abs(v),Math.abs(N))&&Math.abs(y-A)<=1e-6*Math.max(1,Math.abs(y),Math.abs(A))&&Math.abs(m-P)<=1e-6*Math.max(1,Math.abs(m),Math.abs(P))}function _(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t}function j(t,e,r,n){var i=e[0],a=e[1];return t[0]=i+n*(r[0]-i),t[1]=a+n*(r[1]-a),t}!function(){var t=function(){var t=new b(2);return b!=Float32Array&&(t[0]=0,t[1]=0),t}()}();!function(){var t=function(){var t=new b(3);return b!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}()}();function T(t,e){if(!t)throw new Error(e||"@math.gl/web-mercator: assertion failed.")}var O=Math.PI,N=O/4,A=O/180,P=180/O;function C(t){return Math.pow(2,t)}function z(t){var e=y(t,2),r=e[0],n=e[1];T(Number.isFinite(r)),T(Number.isFinite(n)&&n>=-90&&n<=90,"invalid latitude");var i=n*A;return[512*(r*A+O)/(2*O),512*(O+Math.log(Math.tan(N+.5*i)))/(2*O)]}function I(t){var e=y(t,2),r=e[0],n=e[1],i=r/512*(2*O)-O,a=2*(Math.atan(Math.exp(n/512*(2*O)-O))-N);return[i*P,a*P]}function F(t){var e=t.latitude,r=t.longitude,n=t.highPrecision,i=void 0!==n&&n;T(Number.isFinite(e)&&Number.isFinite(r));var a={},o=Math.cos(e*A),s=512/360/o,u=512/4003e4/o;if(a.unitsPerMeter=[u,u,u],a.metersPerUnit=[1/u,1/u,1/u],a.unitsPerDegree=[512/360,s,u],a.degreesPerUnit=[.703125,1/s,1/u],i){var h=A*Math.tan(e*A)/o,c=512/360*h/2,l=512/4003e4*h,f=l/s*u;a.unitsPerDegree2=[0,c,l],a.unitsPerMeter2=[f,0,f]}return a}function U(t){var e=t.height,r=t.pitch,n=t.bearing,i=t.altitude,a=t.scale,o=t.center,s=void 0===o?null:o,u=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];return S(u,u,[0,0,-i]),function(t,e,r){var n=Math.sin(r),i=Math.cos(r),a=e[4],o=e[5],s=e[6],u=e[7],h=e[8],c=e[9],l=e[10],f=e[11];e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=a*i+h*n,t[5]=o*i+c*n,t[6]=s*i+l*n,t[7]=u*i+f*n,t[8]=h*i-a*n,t[9]=c*i-o*n,t[10]=l*i-s*n,t[11]=f*i-u*n}(u,u,-r*A),function(t,e,r){var n=Math.sin(r),i=Math.cos(r),a=e[0],o=e[1],s=e[2],u=e[3],h=e[4],c=e[5],l=e[6],f=e[7];e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=a*i+h*n,t[1]=o*i+c*n,t[2]=s*i+l*n,t[3]=u*i+f*n,t[4]=h*i-a*n,t[5]=c*i-o*n,t[6]=l*i-s*n,t[7]=f*i-u*n}(u,u,n*A),k(u,u,[a/=e,a,a]),s&&S(u,u,function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}([],s)),u}function B(t){var e=t.width,r=t.height,n=t.pitch,i=function(t){var e=t.width,r=t.height,n=t.altitude,i=void 0===n?1.5:n,a=t.pitch,o=void 0===a?0:a,s=t.nearZMultiplier,u=void 0===s?1:s,h=t.farZMultiplier,c=void 0===h?1:h,l=o*A,f=Math.atan(.5/i),d=Math.sin(f)*i/Math.sin(Math.PI/2-l-f);return{fov:2*f,aspect:e/r,focalDistance:i,near:u,far:(Math.cos(Math.PI/2-l)*d+i)*c}}({width:e,height:r,altitude:t.altitude,pitch:n,nearZMultiplier:t.nearZMultiplier,farZMultiplier:t.farZMultiplier});return function(t,e,r,n,i){var a,o=1/Math.tan(e/2);return t[0]=o/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=i&&i!==1/0?(a=1/(n-i),t[10]=(i+n)*a,t[14]=2*i*n*a):(t[10]=-1,t[14]=-2*n),t}([],i.fov,i.aspect,i.near,i.far)}function R(t,e){var r=y(t,3),n=r[0],i=r[1],a=r[2],o=void 0===a?0:a;return T(Number.isFinite(n)&&Number.isFinite(i)&&Number.isFinite(o)),x(e,[n,i,o,1])}function D(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=y(t,3),i=n[0],a=n[1],o=n[2];if(T(Number.isFinite(i)&&Number.isFinite(a),"invalid pixel coordinate"),Number.isFinite(o)){var s=x(e,[i,a,o,1]);return s}var u=x(e,[i,a,0,1]),h=x(e,[i,a,1,1]),c=u[2],l=h[2],f=c===l?0:((r||0)-c)/(l-c);return j([],u,h,f)}var V=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];function Z(t){var e=t.width,r=t.height,n=t.bounds,i=t.minExtent,a=void 0===i?0:i,o=t.maxZoom,s=void 0===o?24:o,u=t.padding,h=void 0===u?0:u,c=t.offset,l=void 0===c?[0,0]:c,f=y(n,2),d=y(f[0],2),p=d[0],v=d[1],m=y(f[1],2),b=m[0],g=m[1];if(Number.isFinite(h)){h={top:h,bottom:h,left:h,right:h}}else T(Number.isFinite(h.top)&&Number.isFinite(h.bottom)&&Number.isFinite(h.left)&&Number.isFinite(h.right));var w=new G({width:e,height:r,longitude:0,latitude:0,zoom:0}),x=w.project([p,g]),M=w.project([b,v]),L=[Math.max(Math.abs(M[0]-x[0]),a),Math.max(Math.abs(M[1]-x[1]),a)],S=[e-h.left-h.right-2*Math.abs(l[0]),r-h.top-h.bottom-2*Math.abs(l[1])];T(S[0]>0&&S[1]>0);var k=S[0]/L[0],E=S[1]/L[1],_=(h.right-h.left)/2/k,j=(h.bottom-h.top)/2/E,O=[(M[0]+x[0])/2+_,(M[1]+x[1])/2+j],N=w.unproject(O),A=Math.min(s,w.zoom+Math.log2(Math.abs(Math.min(k,E))));return T(Number.isFinite(A)),{longitude:N[0],latitude:N[1],zoom:A}}var G=function(t){function e(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=r.width,a=r.height,o=r.latitude,s=void 0===o?0:o,l=r.longitude,f=void 0===l?0:l,d=r.zoom,p=void 0===d?0:d,v=r.pitch,y=void 0===v?0:v,m=r.bearing,b=void 0===m?0:m,g=r.altitude,w=void 0===g?1.5:g,x=r.nearZMultiplier,M=void 0===x?.02:x,L=r.farZMultiplier,S=void 0===L?1.01:L;i(this,e),n=n||1,a=a||1;var k=C(p);w=Math.max(.75,w);var E=z([f,s]);E[2]=0;var _=B({width:n,height:a,pitch:y,bearing:b,altitude:w,nearZMultiplier:M,farZMultiplier:S}),j=U({height:a,scale:k,center:E,pitch:y,bearing:b,altitude:w});return(t=h(this,c(e).call(this,{width:n,height:a,scale:k,viewMatrix:j,projectionMatrix:_}))).latitude=s,t.longitude=f,t.zoom=p,t.pitch=y,t.bearing=b,t.altitude=w,t.center=E,t.unitsPerMeter=F(u(t)).unitsPerMeter[2],Object.freeze(u(t)),t}return d(e,t),o(e,[{key:"projectFlat",value:function(t){return z(t)}},{key:"unprojectFlat",value:function(t){return I(t)}},{key:"getMapCenterByLngLatPosition",value:function(t){var e=t.lngLat,r=D(t.pos,this.pixelUnprojectionMatrix),n=_([],z(e),function(t,e){return t[0]=-e[0],t[1]=-e[1],t}([],r));return I(_([],this.center,n),this.scale)}},{key:"getLocationAtPoint",value:function(t){var e=t.lngLat,r=t.pos;return this.getMapCenterByLngLatPosition({lngLat:e,pos:r})}},{key:"fitBounds",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this.width,i=this.height,a=Z(Object.assign({width:n,height:i,bounds:t},r)),o=a.longitude,s=a.latitude,u=a.zoom;return new e({width:n,height:i,longitude:o,latitude:s,zoom:u})}}]),e}(function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=e.width,n=e.height,a=e.scale,o=e.viewMatrix,s=void 0===o?V:o,u=e.projectionMatrix,h=void 0===u?V:u;i(this,t),this.width=r||1,this.height=n||1,this.scale=a,this.unitsPerMeter=1,this.viewMatrix=s,this.projectionMatrix=h;var c=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];L(c,c,this.projectionMatrix),L(c,c,this.viewMatrix),this.viewProjectionMatrix=c;var l=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];k(l,l,[this.width/2,-this.height/2,1]),S(l,l,[1,-1,0]),L(l,l,this.viewProjectionMatrix);var f=M([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],l);if(!f)throw new Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=l,this.pixelUnprojectionMatrix=f,this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}return o(t,[{key:"equals",value:function(e){return e instanceof t&&(e.width===this.width&&e.height===this.height&&E(e.projectionMatrix,this.projectionMatrix)&&E(e.viewMatrix,this.viewMatrix))}},{key:"project",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e.topLeft,n=void 0===r||r,i=this.projectPosition(t),a=R(i,this.pixelProjectionMatrix),o=y(a,2),s=o[0],u=o[1],h=n?u:this.height-u;return 2===t.length?[s,h]:[s,h,a[2]]}},{key:"unproject",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e.topLeft,n=void 0===r||r,i=e.targetZ,a=y(t,3),o=a[0],s=a[1],u=a[2],h=n?s:this.height-s,c=i&&i*this.unitsPerMeter,l=D([o,h,u],this.pixelUnprojectionMatrix,c),f=this.unprojectPosition(l),d=y(f,3),p=d[0],v=d[1],m=d[2];return Number.isFinite(u)?[p,v,m]:Number.isFinite(i)?[p,v,i]:[p,v]}},{key:"projectPosition",value:function(t){var e=y(this.projectFlat(t),2);return[e[0],e[1],(t[2]||0)*this.unitsPerMeter]}},{key:"unprojectPosition",value:function(t){var e=y(this.unprojectFlat(t),2);return[e[0],e[1],(t[2]||0)/this.unitsPerMeter]}},{key:"projectFlat",value:function(t){arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.scale;return t}},{key:"unprojectFlat",value:function(t){arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.scale;return t}}]),t}()),J={type:"url",value:"",validate:function(t){return"string"==typeof t||Array.isArray(t)&&t.every((function(t){return"string"==typeof t}))},equals:function(t,e){if(t===e)return!0;if(!Array.isArray(t)||!Array.isArray(e))return!1;var r=t.length;if(r!==e.length)return!1;for(var n=0;n<r;n++)if(t[n]!==e[n])return!1;return!0}};function Y(t){var e=[t.unproject([0,0]),t.unproject([t.width,0]),t.unproject([0,t.height]),t.unproject([t.width,t.height])];return[Math.min(e[0][0],e[1][0],e[2][0],e[3][0]),Math.min(e[0][1],e[1][1],e[2][1],e[3][1]),Math.max(e[0][0],e[1][0],e[2][0],e[3][0]),Math.max(e[0][1],e[1][1],e[2][1],e[3][1])]}function W(t,e){var r=y(z(t),2),n=r[0],i=r[1];return[n*=e/512,i=(1-i/512)*e]}function q(t,e){var r=y(t,2);return[r[0]*e/512,r[1]*e/512]}function K(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:512;return 512*Math.pow(2,t)/e}function X(t,e,r){var n=K(r),i=t/n*360-180,a=Math.PI-2*Math.PI*e/n;return[i,180/Math.PI*Math.atan(.5*(Math.exp(a)-Math.exp(-a)))]}function $(t,e,r,n){var i=K(r,n);return[t/i*512,e/i*512]}function H(t,e,r,n){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:512;if(t.isGeospatial){var a=X(e,r,n),o=y(a,2),s=o[0],u=o[1],h=X(e+1,r+1,n),c=y(h,2),l=c[0],f=c[1];return{west:s,north:u,east:l,south:f}}var d=$(e,r,n,i),p=y(d,2),v=p[0],m=p[1],b=$(e+1,r+1,n,i),g=y(b,2),w=g[0],x=g[1];return{left:v,top:m,right:w,bottom:x}}function Q(t,e,r){for(var n=Y(t),i=K(e,r),a=y(q([n[0],n[1]],i),2),o=a[0],s=a[1],u=y(q([n[2],n[3]],i),2),h=u[0],c=u[1],l=[],f=Math.floor(o);f<h;f++)for(var d=Math.floor(s);d<c;d++)l.push({x:f,y:d,z:e});return l}function tt(t,e){var r=Y(t),n=K(e),i=y(W([r[0],r[3]],n),2),a=i[0],o=i[1],s=y(W([r[2],r[1]],n),2),u=s[0],h=s[1],c=[];a=Math.floor(a),u=Math.min(a+n,u),o=Math.max(0,Math.floor(o)),h=Math.min(n,h);for(var l=a;l<u;l++)for(var f=o;f<h;f++){var d=l-Math.floor(l/n)*n;c.push({x:d,y:f,z:e})}return c}var et=function(){function t(e){var r=this;i(this,t),this.opts=e,this._getTileData=e.getTileData,this.onTileError=e.onTileError,this.onTileLoad=function(t){e.onTileLoad(t),r.opts.maxCacheByteSize&&(r._cacheByteSize+=t.byteLength,r._resizeCache())},this._cache=new Map,this._tiles=[],this._dirty=!1,this._cacheByteSize=0,this._viewport=null,this._selectedTiles=null,this._frameNumber=0,this.setOptions(e)}return o(t,[{key:"setOptions",value:function(t){Object.assign(this.opts,t),Number.isFinite(t.maxZoom)&&(this._maxZoom=Math.floor(t.maxZoom)),Number.isFinite(t.minZoom)&&(this._minZoom=Math.ceil(t.minZoom))}},{key:"update",value:function(t){var e=this;if(t!==this._viewport){this._viewport=t;var r=this.getTileIndices({viewport:t,maxZoom:this._maxZoom,minZoom:this._minZoom});this._selectedTiles=r.map((function(t){return e._getTile(t,!0)})),this._dirty&&this._rebuildTree()}var n=this.updateTileStates();return this._dirty&&this._resizeCache(),n&&this._frameNumber++,this._frameNumber}},{key:"getTileIndices",value:function(t){return function(t,e,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:512,i=Math.ceil(t.zoom);return Number.isFinite(r)&&i<r?[]:(Number.isFinite(e)&&i>e&&(i=e),t.isGeospatial?tt(t,i):Q(t,i,n))}(t.viewport,t.maxZoom,t.minZoom,this.opts.tileSize)}},{key:"getTileMetadata",value:function(t){var e=t.x,r=t.y,n=t.z;return{bbox:H(this._viewport,e,r,n,this.opts.tileSize)}}},{key:"getParentIndex",value:function(t){return t.x=Math.floor(t.x/2),t.y=Math.floor(t.y/2),t.z-=1,t}},{key:"updateTileStates",value:function(){this._updateTileStates(this.selectedTiles);var t=!1,e=!0,r=!1,n=void 0;try{for(var i,a=this._cache.values()[Symbol.iterator]();!(e=(i=a.next()).done);e=!0){var o=i.value,s=Boolean(1&o.state);o.isVisible!==s&&(t=!0,o.isVisible=s)}}catch(t){r=!0,n=t}finally{try{e||null==a.return||a.return()}finally{if(r)throw n}}return t}},{key:"_rebuildTree",value:function(){var t=this._cache,e=!0,r=!1,n=void 0;try{for(var i,a=t.values()[Symbol.iterator]();!(e=(i=a.next()).done);e=!0){var o=i.value;o.parent=null,o.children.length=0}}catch(t){r=!0,n=t}finally{try{e||null==a.return||a.return()}finally{if(r)throw n}}var s=!0,u=!1,h=void 0;try{for(var c,l=t.values()[Symbol.iterator]();!(s=(c=l.next()).done);s=!0){var f=c.value,d=this._getNearestAncestor(f.x,f.y,f.z);f.parent=d,d&&d.children.push(f)}}catch(t){u=!0,h=t}finally{try{s||null==l.return||l.return()}finally{if(u)throw h}}}},{key:"_updateTileStates",value:function(t){var e=this._cache,r=this.opts.refinementStrategy||"best-available",n=!0,i=!1,a=void 0;try{for(var o,s=e.values()[Symbol.iterator]();!(n=(o=s.next()).done);n=!0){o.value.state=0}}catch(t){i=!0,a=t}finally{try{n||null==s.return||s.return()}finally{if(i)throw a}}var u=!0,h=!1,c=void 0;try{for(var l,f=t[Symbol.iterator]();!(u=(l=f.next()).done);u=!0){l.value.state=5}}catch(t){h=!0,c=t}finally{try{u||null==f.return||f.return()}finally{if(h)throw c}}if("never"!==r){var d=!0,p=!1,v=void 0;try{for(var y,m=t[Symbol.iterator]();!(d=(y=m.next()).done);d=!0){nt(y.value,r)}}catch(t){p=!0,v=t}finally{try{d||null==m.return||m.return()}finally{if(p)throw v}}var b=!0,g=!1,w=void 0;try{for(var x,M=t[Symbol.iterator]();!(b=(x=M.next()).done);b=!0){var L=x.value;rt(L)&&it(L)}}catch(t){g=!0,w=t}finally{try{b||null==M.return||M.return()}finally{if(g)throw w}}}}},{key:"_resizeCache",value:function(){var t=this._cache,e=this.opts,r=e.maxCacheSize||(e.maxCacheByteSize?1/0:5*this.selectedTiles.length),n=e.maxCacheByteSize||1/0;if(t.size>r||this._cacheByteSize>n){var i=!0,a=!1,o=void 0;try{for(var s,u=t[Symbol.iterator]();!(i=(s=u.next()).done);i=!0){var h=y(s.value,2),c=h[0],l=h[1];if(l.isVisible||(this._cacheByteSize-=e.maxCacheByteSize?l.byteLength:0,t.delete(c)),t.size<=r&&this._cacheByteSize<=n)break}}catch(t){a=!0,o=t}finally{try{i||null==u.return||u.return()}finally{if(a)throw o}}this._rebuildTree(),this._dirty=!0}this._dirty&&(this._tiles=Array.from(this._cache.values()).sort((function(t,e){return t.z-e.z})),this._dirty=!1)}},{key:"_getTile",value:function(t,e){var r=t.x,n=t.y,i=t.z,a="".concat(r,",").concat(n,",").concat(i),o=this._cache.get(a);return!o&&e&&(o=new m({x:r,y:n,z:i,onTileLoad:this.onTileLoad,onTileError:this.onTileError}),Object.assign(o,this.getTileMetadata(o)),o.loadData(this._getTileData),this._cache.set(a,o),this._dirty=!0),o}},{key:"_getNearestAncestor",value:function(t,e,r){for(var n=this._minZoom,i=void 0===n?0:n,a={x:t,y:e,z:r};a.z>i;){a=this.getParentIndex(a);var o=this._getTile(a);if(o)return o}return null}},{key:"tiles",get:function(){return this._tiles}},{key:"selectedTiles",get:function(){return this._selectedTiles}},{key:"isLoaded",get:function(){return this._selectedTiles.every((function(t){return t.isLoaded}))}}]),t}();function rt(t){for(var e=t;e;){if(!1&e.state)return!0;if(e.isLoaded)return!1;e=e.parent}return!0}function nt(t,e){for(var r,n=3;r=t.parent;){if(t.isLoaded&&(n=4,"best-available"===e))return;r.state=Math.max(r.state,n),t=r}}function it(t){var e=!0,r=!1,n=void 0;try{for(var i,a=t.children[Symbol.iterator]();!(e=(i=a.next()).done);e=!0){var o=i.value;o.state=Math.max(o.state,3),o.isLoaded||it(o)}}catch(t){r=!0,n=t}finally{try{e||null==a.return||a.return()}finally{if(r)throw n}}}var at={data:[],dataComparator:J.equals,renderSubLayers:{type:"function",value:function(t){return new e.GeoJsonLayer(t)},compare:!1},getTileData:{type:"function",optional:!0,value:null,compare:!1},onViewportLoad:{type:"function",optional:!0,value:null,compare:!1},onTileLoad:{type:"function",value:function(t){},compare:!1},onTileError:{type:"function",value:function(t){return console.error(t)},compare:!1},tileSize:512,maxZoom:null,minZoom:0,maxCacheSize:null,maxCacheByteSize:null,refinementStrategy:"best-available"},ot=function(e){function r(){return i(this,r),h(this,c(r).apply(this,arguments))}return d(r,e),o(r,[{key:"initializeState",value:function(){this.state={tiles:[],isLoaded:!1}}},{key:"shouldUpdateState",value:function(t){return t.changeFlags.somethingChanged}},{key:"updateState",value:function(t){var e=t.props,r=(t.oldProps,t.context,t.changeFlags),n=this.state.tileset,i=!n||r.dataChanged||r.updateTriggersChanged&&(r.updateTriggersChanged.all||r.updateTriggersChanged.getTileData);if(i){var a=e.maxZoom,o=e.minZoom,s=e.tileSize,u=e.maxCacheSize,h=e.maxCacheByteSize,c=e.refinementStrategy;n=new et({getTileData:this.getTileData.bind(this),maxCacheSize:u,maxCacheByteSize:h,maxZoom:a,minZoom:o,tileSize:s,refinementStrategy:c,onTileLoad:this._onTileLoad.bind(this),onTileError:this._onTileError.bind(this)}),this.setState({tileset:n})}else r.propsChanged&&(n.setOptions(e),this.state.tileset.tiles.forEach((function(t){t.layers=null})));(i||r.viewportChanged)&&this._updateTileset()}},{key:"_updateTileset",value:function(){var t=this.state.tileset,e=this.props.onViewportLoad,r=t.update(this.context.viewport),n=t.isLoaded,i=this.state.isLoaded!==n,a=this.state.frameNumber!==r;n&&e&&(i||a)&&e(t.selectedTiles.map((function(t){return t.data}))),a&&this.setState({frameNumber:r}),this.state.isLoaded=n}},{key:"_onTileLoad",value:function(t){var e=this.getCurrentLayer();e.props.onTileLoad(t),e._updateTileset()}},{key:"_onTileError",value:function(t){var e=this.getCurrentLayer();e.props.onTileError(t),e._updateTileset()}},{key:"getTileData",value:function(t){var e,r,n=this.props,i=n.getTileData,a=n.fetch,o=n.data;return t.url=(r=t,(e=o)&&e.length?(Array.isArray(e)&&(e=e[Math.abs(r.x+r.y)%e.length]),e.replace(/\{ *([\w_-]+) *\}/g,(function(t,e){return r[e]}))):null),i?i(t):t.url?a(t.url,{layer:this}):null}},{key:"renderSubLayers",value:function(t){return this.props.renderSubLayers(t)}},{key:"getPickingInfo",value:function(t){var e=t.info,r=t.sourceLayer;return e.sourceLayer=r,e.tile=r.props.tile,e}},{key:"renderLayers",value:function(){var e=this,r=this.props.visible;return this.state.tileset.tiles.map((function(n){var i=r&&n.isVisible;if(n.layers)n.layers[0]&&n.layers[0].props.visible!==i&&(n.layers=n.layers.map((function(t){return t.clone({visible:i})})));else{var a=e.renderSubLayers(Object.assign({},e.props,{id:"".concat(e.id,"-").concat(n.x,"-").concat(n.y,"-").concat(n.z),data:n.data,visible:i,_offset:0,tile:n}));n.layers=t._flatten(a,Boolean)}return n.layers}))}},{key:"isLoaded",get:function(){return this.state.tileset.selectedTiles.every((function(t){return t.layers&&t.layers.every((function(t){return t.isLoaded}))}))}}]),r}(t.CompositeLayer);function st(t){return function(t){if(Array.isArray(t))return p(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||v(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}ot.layerName="TileLayer",ot.defaultProps=at;var ut=function(t,e){return t(e={exports:{}},e.exports),e.exports}((function(t){var e=function(t){var e=Object.prototype,r=e.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},i=n.iterator||"@@iterator",a=n.asyncIterator||"@@asyncIterator",o=n.toStringTag||"@@toStringTag";function s(t,e,r,n){var i=e&&e.prototype instanceof c?e:c,a=Object.create(i.prototype),o=new M(n||[]);return a._invoke=function(t,e,r){var n="suspendedStart";return function(i,a){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===i)throw a;return S()}for(r.method=i,r.arg=a;;){var o=r.delegate;if(o){var s=g(o,r);if(s){if(s===h)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var c=u(t,e,r);if("normal"===c.type){if(n=r.done?"completed":"suspendedYield",c.arg===h)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(n="completed",r.method="throw",r.arg=c.arg)}}}(t,r,o),a}function u(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=s;var h={};function c(){}function l(){}function f(){}var d={};d[i]=function(){return this};var p=Object.getPrototypeOf,v=p&&p(p(L([])));v&&v!==e&&r.call(v,i)&&(d=v);var y=f.prototype=c.prototype=Object.create(d);function m(t){["next","throw","return"].forEach((function(e){t[e]=function(t){return this._invoke(e,t)}}))}function b(t,e){var n;this._invoke=function(i,a){function o(){return new e((function(n,o){!function n(i,a,o,s){var h=u(t[i],t,a);if("throw"!==h.type){var c=h.arg,l=c.value;return l&&"object"==typeof l&&r.call(l,"__await")?e.resolve(l.__await).then((function(t){n("next",t,o,s)}),(function(t){n("throw",t,o,s)})):e.resolve(l).then((function(t){c.value=t,o(c)}),(function(t){return n("throw",t,o,s)}))}s(h.arg)}(i,a,n,o)}))}return n=n?n.then(o,o):o()}}function g(t,e){var r=t.iterator[e.method];if(void 0===r){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,g(t,e),"throw"===e.method))return h;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return h}var n=u(r,t.iterator,e.arg);if("throw"===n.type)return e.method="throw",e.arg=n.arg,e.delegate=null,h;var i=n.arg;return i?i.done?(e[t.resultName]=i.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,h):i:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,h)}function w(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function x(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function M(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(w,this),this.reset(!0)}function L(t){if(t){var e=t[i];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,a=function e(){for(;++n<t.length;)if(r.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=void 0,e.done=!0,e};return a.next=a}}return{next:S}}function S(){return{value:void 0,done:!0}}return l.prototype=y.constructor=f,f.constructor=l,f[o]=l.displayName="GeneratorFunction",t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===l||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,f):(t.__proto__=f,o in t||(t[o]="GeneratorFunction")),t.prototype=Object.create(y),t},t.awrap=function(t){return{__await:t}},m(b.prototype),b.prototype[a]=function(){return this},t.AsyncIterator=b,t.async=function(e,r,n,i,a){void 0===a&&(a=Promise);var o=new b(s(e,r,n,i),a);return t.isGeneratorFunction(r)?o:o.next().then((function(t){return t.done?t.value:o.next()}))},m(y),y[o]="Generator",y[i]=function(){return this},y.toString=function(){return"[object Generator]"},t.keys=function(t){var e=[];for(var r in t)e.push(r);return e.reverse(),function r(){for(;e.length;){var n=e.pop();if(n in t)return r.value=n,r.done=!1,r}return r.done=!0,r}},t.values=L,M.prototype={constructor:M,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(x),!t)for(var e in this)"t"===e.charAt(0)&&r.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(r,n){return o.type="throw",o.arg=t,e.next=r,n&&(e.method="next",e.arg=void 0),!!n}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],o=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var s=r.call(a,"catchLoc"),u=r.call(a,"finallyLoc");if(s&&u){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var a=i;break}}a&&("break"===t||"continue"===t)&&a.tryLoc<=e&&e<=a.finallyLoc&&(a=null);var o=a?a.completion:{};return o.type=t,o.arg=e,a?(this.method="next",this.next=a.finallyLoc,h):this.complete(o)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),h},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),x(r),h}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var i=n.arg;x(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:L(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),h}},t}(t.exports);try{regeneratorRuntime=e}catch(t){Function("r","regeneratorRuntime = r")(e)}}));function ht(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function ct(t,e,r,n,i,a,o){try{var s=t[a](o),u=s.value}catch(t){return void r(t)}s.done?e(u):Promise.resolve(u).then(n,i)}function lt(t){return function(){var e=this,r=arguments;return new Promise((function(n,i){var a=t.apply(e,r);function o(t){ct(a,n,i,o,s,"next",t)}function s(t){ct(a,n,i,o,s,"throw",t)}o(void 0)}))}}function ft(t,e){if(!t)throw new Error(e)}var dt={self:"undefined"!=typeof self&&self,window:"undefined"!=typeof window&&window,global:"undefined"!=typeof global&&global,document:"undefined"!=typeof document&&document},pt=dt.global||dt.self||dt.window,vt="object"!==("undefined"==typeof process?"undefined":s(process))||"[object process]"!==String(process)||process.browser,yt="undefined"!=typeof process&&process.version&&process.version.match(/v([0-9]*)/),mt=(yt&&parseFloat(yt[1]),pt._parseImageNode),bt="undefined"!=typeof Image,gt="undefined"!=typeof ImageBitmap,wt=Boolean(mt);function xt(t){switch(t){case"auto":return gt||bt||wt;case"imagebitmap":return gt;case"html":case"image":return bt;case"ndarray":case"data":return!!vt||wt;default:throw new Error("@loaders.gl/images: image ".concat(t," not supported in this environment"))}}function Mt(t){var e=function(t){if("undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap)return"imagebitmap";if("undefined"!=typeof Image&&t instanceof Image)return"image";if(t&&"object"===s(t)&&t.data&&t.width&&t.height)return"data";return null}(t);if(!e)throw new Error("Not an image");return e}function Lt(t){switch(Mt(t)){case"data":return t;case"image":case"imagebitmap":var e=document.createElement("canvas"),r=e.getContext("2d");return e.width=t.width,e.height=t.height,r.drawImage(t,0,0),r.getImageData(0,0,t.width,t.height);default:return ft(!1)}}var St=/^data:image\/svg\+xml/,kt=/\.svg((\?|#).*)?$/;function Et(t,e){return jt(e)?(console.warn("SVG cannot be parsed to imagebitmap"),new Blob([new Uint8Array(t)],{type:"image/svg+xml"})):new Blob([new Uint8Array(t)])}function _t(t,e){if(jt(e)){var r=(new TextDecoder).decode(t);return"data:image/svg+xml;base64,".concat(btoa(r))}return Et(t,e)}function jt(t){return t&&(St.test(t)||kt.test(t))}function Tt(t,e,r){return Ot.apply(this,arguments)}function Ot(){return(Ot=lt(ut.mark((function t(e,r,n){var i,a,o;return ut.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=_t(e,n),a=self.URL||self.webkitURL,o="string"!=typeof i&&a.createObjectURL(i),t.prev=3,t.next=6,Nt(o||i,r);case 6:return t.abrupt("return",t.sent);case 7:return t.prev=7,o&&a.revokeObjectURL(o),t.finish(7);case 10:case"end":return t.stop()}}),t,null,[[3,,7,10]])})))).apply(this,arguments)}function Nt(t,e){return At.apply(this,arguments)}function At(){return(At=lt(ut.mark((function t(e,r){var n;return ut.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if((n=new Image).src=e,!(r.image&&r.image.decode&&n.decode)){t.next=6;break}return t.next=5,n.decode();case 5:return t.abrupt("return",n);case 6:return t.next=8,new Promise((function(t,r){try{n.onload=function(){return t(n)},n.onerror=function(t){return r(new Error("Could not load image ".concat(e,": ").concat(t)))}}catch(t){r(t)}}));case 8:return t.abrupt("return",t.sent);case 9:case"end":return t.stop()}}),t)})))).apply(this,arguments)}var Pt=!0;function Ct(t,e,r){return zt.apply(this,arguments)}function zt(){return(zt=lt(ut.mark((function t(e,r,n){var i,a;return ut.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i=Et(e,n),!Ft(a=r&&r.imagebitmap)&&Pt||(a=null),!a){t.next=14;break}return t.prev=4,t.next=7,createImageBitmap(i,a);case 7:return t.abrupt("return",t.sent);case 10:t.prev=10,t.t0=t.catch(4),console.warn(t.t0),Pt=!1;case 14:return t.next=16,createImageBitmap(i);case 16:return t.abrupt("return",t.sent);case 17:case"end":return t.stop()}}),t,null,[[4,10]])})))).apply(this,arguments)}var It={};function Ft(t){for(var e in t||It)return!0;return!1}var Ut=new Map([["image/png",{test:Bt,getSize:function(t){return{width:t.getUint32(16,!1),height:t.getUint32(20,!1)}}}],["image/jpeg",{test:Vt,getSize:function(t){if(t.byteLength<2||65496!==t.getUint16(0,!1))return null;var e=function(){for(var t=new Set([65499,65476,65484,65501,65534]),e=65504;e<65520;++e)t.add(e);var r=new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502]);return{tableMarkers:t,sofMarkers:r}}(),r=e.tableMarkers,n=e.sofMarkers,i=2;for(;i<t.byteLength;){var a=t.getUint16(i,!1);if(n.has(a))return{height:t.getUint16(i+5,!1),width:t.getUint16(i+7,!1)};if(!r.has(a))return null;i+=2,i+=t.getUint16(i,!1)}return null}}],["image/gif",{test:Rt,getSize:function(t){return{width:t.getUint16(6,!0),height:t.getUint16(8,!0)}}}],["image/bmp",{test:Dt,getSize:function(t){return{width:t.getUint32(18,!0),height:t.getUint32(22,!0)}}}]]);function Bt(t){return t.byteLength>=24&&2303741511===t.getUint32(0,!1)}function Rt(t){return t.byteLength>=10&&1195984440===t.getUint32(0,!1)}function Dt(t){return t.byteLength>=14&&16973===t.getUint16(0,!1)&&t.getUint32(2,!0)===t.byteLength}function Vt(t){return t.byteLength>=3&&65496===t.getUint16(0,!1)&&255===t.getUint8(2,!1)}"Invalid MIME type. Supported MIME types are: ".concat(Array.from(Ut.keys()).join(", "));function Zt(t){var e=function(t){if((t=t.buffer||t)instanceof ArrayBuffer)return new DataView(t);if(ArrayBuffer.isView(t))return new DataView(t.buffer);throw new Error("toDataView")}(t),r=!0,n=!1,i=void 0;try{for(var a,o=Ut.entries()[Symbol.iterator]();!(r=(a=o.next()).done);r=!0){var s=y(a.value,2),u=s[0];if((0,s[1].test)(e))return u}}catch(t){n=!0,i=t}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}return null}function Gt(t,e){var r=Zt(t),n=pt._parseImageNode;return ft(n),n(t,r,e)}function Jt(){return(Jt=lt(ut.mark((function t(e,r,n){var i,a,o,s,u;return ut.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:i=(r=r||{}).image||{},a=i.type||"auto",o=(n||{}).url,s=Yt(a),t.t0=s,t.next="imagebitmap"===t.t0?8:"image"===t.t0?12:"data"===t.t0?16:20;break;case 8:return t.next=10,Ct(e,r,o);case 10:return u=t.sent,t.abrupt("break",21);case 12:return t.next=14,Tt(e,r,o);case 14:return u=t.sent,t.abrupt("break",21);case 16:return t.next=18,Gt(e,r);case 18:return u=t.sent,t.abrupt("break",21);case 20:ft(!1);case 21:return"data"===a&&(u=Lt(u)),t.abrupt("return",u);case 23:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function Yt(t){switch(t){case"auto":case"data":return function(){if(xt("image"))return"image";if(xt("imagebitmap"))return"imagebitmap";if(xt("data"))return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}();default:return xt(t),t}}var Wt={name:"Images",version:"2.1.4",mimeTypes:["image/png","image/jpeg","image/gif","image/webp","image/bmp","image/vndmicrosofticon","image/svg+xml"],extensions:["png","jpg","jpeg","gif","webp","bmp","ico","svg"],parse:function(t,e,r){return Jt.apply(this,arguments)},test:function(t){var e=new DataView(t);return Vt(e)||Dt(e)||Rt(e)||Bt(e)},options:{image:{format:"auto",decode:!0}}};function qt(t,e){if(t===e)return!0;if(!t||!e)return!1;for(const r in t){const n=t[r],i=e[r];if(!(n===i||Array.isArray(n)&&Array.isArray(i)&&qt(n,i)))return!1}return!0}function Kt(t,e,...r){return new Promise((n,i)=>t[e](...r,(t,e)=>{e?i(e):n(t)}))}var Xt=function(){function t(e,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100;i(this,t),this.TableBatchType=e,this.schema=r,this.batchSize=n,this.batch=null,this.batchCount=0}return o(t,[{key:"addRow",value:function(t){if(!this.batch){var e=this.TableBatchType;this.batch=new e(this.schema,this.batchSize)}this.batch.addRow(t)}},{key:"chunkComplete",value:function(){this.batch&&this.batch.chunkComplete()}},{key:"isFull",value:function(){return this.batch&&this.batch.isFull()}},{key:"hasBatch",value:function(){return Boolean(this.batch)}},{key:"getNormalizedBatch",value:function(){if(this.batch){var t=this.batch.getNormalizedBatch();return this.batch=null,t.count=this.batchCount,this.batchCount++,t}return null}}]),t}(),$t=function(){function t(e,r){if(i(this,t),this.schema=e,this.batchSize=r,this.rows=null,this.length=0,this.isChunkComplete=!1,!Array.isArray(e))for(var n in this._headers=[],e)this._headers[e[n].index]=e[n].name}return o(t,[{key:"addRow",value:function(t){this.rows||(this.rows=new Array(this.batchSize),this.length=0),this.rows[this.length]=function(t,e){if(!t)throw new Error("null row");if(!Array.isArray(t))return t;if(!e)return t;for(var r={},n=0;n<e.length;n++)r[e[n]]=t[n];return r}(t,this._headers),this.length++}},{key:"chunkComplete",value:function(){this.isChunkComplete=!0}},{key:"isFull",value:function(){return"auto"===this.batchSize?this.isChunkComplete&&this.length>0:this.rows&&this.length>=this.batchSize}},{key:"getNormalizedBatch",value:function(){if(this.rows){var t=this.rows.slice(0,this.length);return this.rows=null,this.isChunkComplete=!1,{data:t,schema:this.schema,length:t.length}}return null}}]),t}();function Ht(t,e){try{var r=JSON.parse(t);return e.json.table&&function t(e){if(Array.isArray(e))return e;if(e&&"object"===s(e))for(var r=0,n=Object.values(e);r<n.length;r++){var i=n[r],a=t(i);if(a)return a}return null}(r)||r}catch(t){throw new Error("JSONLoader: failed to parse JSON")}}function Qt(t){this.wrapped=t}function te(t){return new Qt(t)}function ee(t){var e,r;function n(e,r){try{var a=t[e](r),o=a.value,s=o instanceof Qt;Promise.resolve(s?o.wrapped:o).then((function(t){s?n("return"===e?"return":"next",t):i(a.done?"return":"normal",t)}),(function(t){n("throw",t)}))}catch(t){i("throw",t)}}function i(t,i){switch(t){case"return":e.resolve({value:i,done:!0});break;case"throw":e.reject(i);break;default:e.resolve({value:i,done:!1})}(e=e.next)?n(e.key,e.arg):r=null}this._invoke=function(t,i){return new Promise((function(a,o){var s={key:t,arg:i,resolve:a,reject:o,next:null};r?r=r.next=s:(e=r=s,n(t,i))}))},"function"!=typeof t.return&&(this.return=void 0)}function re(t){return function(){return new ee(t.apply(this,arguments))}}function ne(t){var e;if("undefined"!=typeof Symbol){if(Symbol.asyncIterator&&null!=(e=t[Symbol.asyncIterator]))return e.call(t);if(Symbol.iterator&&null!=(e=t[Symbol.iterator]))return e.call(t)}throw new TypeError("Object is not async iterable")}"function"==typeof Symbol&&Symbol.asyncIterator&&(ee.prototype[Symbol.asyncIterator]=function(){return this}),ee.prototype.next=function(t){return this._invoke("next",t)},ee.prototype.throw=function(t){return this._invoke("throw",t)},ee.prototype.return=function(t){return this._invoke("return",t)};var ie=Number.MAX_SAFE_INTEGER,ae={textNode:void 0,numberNode:""},oe=0,se={BEGIN:oe++,VALUE:oe++,OPEN_OBJECT:oe++,CLOSE_OBJECT:oe++,OPEN_ARRAY:oe++,CLOSE_ARRAY:oe++,TEXT_ESCAPE:oe++,STRING:oe++,BACKSLASH:oe++,END:oe++,OPEN_KEY:oe++,CLOSE_KEY:oe++,TRUE:oe++,TRUE2:oe++,TRUE3:oe++,FALSE:oe++,FALSE2:oe++,FALSE3:oe++,FALSE4:oe++,NULL:oe++,NULL2:oe++,NULL3:oe++,NUMBER_DECIMAL_POINT:oe++,NUMBER_DIGIT:oe++};for(var ue in se)se[se[ue]]=ue;oe=se;var he=9,ce=10,le=13,fe=32,de=34,pe=43,ve=44,ye=45,me=46,be=48,ge=57,we=58,xe=69,Me=91,Le=92,Se=93,ke=97,Ee=98,_e=101,je=102,Te=108,Oe=110,Ne=114,Ae=115,Pe=116,Ce=117,ze=123,Ie=125;var Fe=/[\\"\n]/g,Ue=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i(this,t),this._initialize(e)}return o(t,[{key:"_initialize",value:function(t){this._clearBuffers(this),this.bufferCheckPosition=ie,this.q="",this.c="",this.p="",this.options=t||{},this.closed=!1,this.closedRoot=!1,this.sawRoot=!1,this.tag=null,this.error=null,this.state=oe.BEGIN,this.stack=new Array,this.position=this.column=0,this.line=1,this.slashed=!1,this.unicodeI=0,this.unicodeS=null,this.depth=0,"onready"in t&&(this.onready=t.onready),"onopenobject"in t&&(this.onopenobject=t.onopenobject),"onkey"in t&&(this.onkey=t.onkey),"oncloseobject"in t&&(this.oncloseobject=t.oncloseobject),"onopenarray"in t&&(this.onopenarray=t.onopenarray),"onclosearray"in t&&(this.onclosearray=t.onclosearray),"onvalue"in t&&(this.onvalue=t.onvalue),"onerror"in t&&(this.onerror=t.onerror),"onend"in t&&(this.onend=t.onend),"onchunkparsed"in t&&(this.onchunkparsed=t.onchunkparsed),Be(this,"onready")}},{key:"_clearBuffers",value:function(){for(var t in ae)this[t]=ae[t]}},{key:"end",value:function(){return this.state===oe.VALUE&&0===this.depth||Ze(this,"Unexpected end"),De(this),this.c="",this.closed=!0,Be(this,"onend"),this._initialize(this.options),this}},{key:"resume",value:function(){return this.error=null,this}},{key:"close",value:function(){return this.write(null)}},{key:"write",value:function(t){if(this.error)throw this.error;if(this.closed)return Ze(this,"Cannot write after close. Assign an onready handler.");if(null===t)return this.end();for(var e=0,r=t.charCodeAt(0),n=this.p;r&&(n=r,this.c=r=t.charCodeAt(e++),n!==r?this.p=n:n=this.p,r);)switch(this.position++,r===ce?(this.line++,this.column=0):this.column++,this.state){case oe.BEGIN:r===ze?this.state=oe.OPEN_OBJECT:r===Me?this.state=oe.OPEN_ARRAY:Ge(r)||Ze(this,"Non-whitespace before {[.");continue;case oe.OPEN_KEY:case oe.OPEN_OBJECT:if(Ge(r))continue;if(this.state===oe.OPEN_KEY)this.stack.push(oe.CLOSE_KEY);else{if(r===Ie){Be(this,"onopenobject"),this.depth++,Be(this,"oncloseobject"),this.depth--,this.state=this.stack.pop()||oe.VALUE;continue}this.stack.push(oe.CLOSE_OBJECT)}r===de?this.state=oe.STRING:Ze(this,'Malformed object key should start with "');continue;case oe.CLOSE_KEY:case oe.CLOSE_OBJECT:if(Ge(r))continue;this.state,oe.CLOSE_KEY;r===we?(this.state===oe.CLOSE_OBJECT?(this.stack.push(oe.CLOSE_OBJECT),De(this,"onopenobject"),this.depth++):De(this,"onkey"),this.state=oe.VALUE):r===Ie?(Re(this,"oncloseobject"),this.depth--,this.state=this.stack.pop()||oe.VALUE):r===ve?(this.state===oe.CLOSE_OBJECT&&this.stack.push(oe.CLOSE_OBJECT),De(this),this.state=oe.OPEN_KEY):Ze(this,"Bad object");continue;case oe.OPEN_ARRAY:case oe.VALUE:if(Ge(r))continue;if(this.state===oe.OPEN_ARRAY){if(Be(this,"onopenarray"),this.depth++,this.state=oe.VALUE,r===Se){Be(this,"onclosearray"),this.depth--,this.state=this.stack.pop()||oe.VALUE;continue}this.stack.push(oe.CLOSE_ARRAY)}r===de?this.state=oe.STRING:r===ze?this.state=oe.OPEN_OBJECT:r===Me?this.state=oe.OPEN_ARRAY:r===Pe?this.state=oe.TRUE:r===je?this.state=oe.FALSE:r===Oe?this.state=oe.NULL:r===ye?this.numberNode+="-":be<=r&&r<=ge?(this.numberNode+=String.fromCharCode(r),this.state=oe.NUMBER_DIGIT):Ze(this,"Bad value");continue;case oe.CLOSE_ARRAY:if(r===ve)this.stack.push(oe.CLOSE_ARRAY),De(this,"onvalue"),this.state=oe.VALUE;else if(r===Se)Re(this,"onclosearray"),this.depth--,this.state=this.stack.pop()||oe.VALUE;else{if(Ge(r))continue;Ze(this,"Bad array")}continue;case oe.STRING:void 0===this.textNode&&(this.textNode="");var i=e-1,a=this.slashed,o=this.unicodeI;t:for(;;){for(;o>0;)if(this.unicodeS+=String.fromCharCode(r),r=t.charCodeAt(e++),this.position++,4===o?(this.textNode+=String.fromCharCode(parseInt(this.unicodeS,16)),o=0,i=e-1):o++,!r)break t;if(r===de&&!a){this.state=this.stack.pop()||oe.VALUE,this.textNode+=t.substring(i,e-1),this.position+=e-1-i;break}if(r===Le&&!a&&(a=!0,this.textNode+=t.substring(i,e-1),this.position+=e-1-i,r=t.charCodeAt(e++),this.position++,!r))break;if(a){if(a=!1,r===Oe?this.textNode+="\n":r===Ne?this.textNode+="\r":r===Pe?this.textNode+="\t":r===je?this.textNode+="\f":r===Ee?this.textNode+="\b":r===Ce?(o=1,this.unicodeS=""):this.textNode+=String.fromCharCode(r),r=t.charCodeAt(e++),this.position++,i=e-1,r)continue;break}Fe.lastIndex=e;var s=Fe.exec(t);if(null===s){e=t.length+1,this.textNode+=t.substring(i,e-1),this.position+=e-1-i;break}if(e=s.index+1,!(r=t.charCodeAt(s.index))){this.textNode+=t.substring(i,e-1),this.position+=e-1-i;break}}this.slashed=a,this.unicodeI=o;continue;case oe.TRUE:r===Ne?this.state=oe.TRUE2:Ze(this,"Invalid true started with t"+r);continue;case oe.TRUE2:r===Ce?this.state=oe.TRUE3:Ze(this,"Invalid true started with tr"+r);continue;case oe.TRUE3:r===_e?(Be(this,"onvalue",!0),this.state=this.stack.pop()||oe.VALUE):Ze(this,"Invalid true started with tru"+r);continue;case oe.FALSE:r===ke?this.state=oe.FALSE2:Ze(this,"Invalid false started with f"+r);continue;case oe.FALSE2:r===Te?this.state=oe.FALSE3:Ze(this,"Invalid false started with fa"+r);continue;case oe.FALSE3:r===Ae?this.state=oe.FALSE4:Ze(this,"Invalid false started with fal"+r);continue;case oe.FALSE4:r===_e?(Be(this,"onvalue",!1),this.state=this.stack.pop()||oe.VALUE):Ze(this,"Invalid false started with fals"+r);continue;case oe.NULL:r===Ce?this.state=oe.NULL2:Ze(this,"Invalid null started with n"+r);continue;case oe.NULL2:r===Te?this.state=oe.NULL3:Ze(this,"Invalid null started with nu"+r);continue;case oe.NULL3:r===Te?(Be(this,"onvalue",null),this.state=this.stack.pop()||oe.VALUE):Ze(this,"Invalid null started with nul"+r);continue;case oe.NUMBER_DECIMAL_POINT:r===me?(this.numberNode+=".",this.state=oe.NUMBER_DIGIT):Ze(this,"Leading zero not followed by .");continue;case oe.NUMBER_DIGIT:be<=r&&r<=ge?this.numberNode+=String.fromCharCode(r):r===me?(-1!==this.numberNode.indexOf(".")&&Ze(this,"Invalid number has two dots"),this.numberNode+="."):r===_e||r===xe?(-1===this.numberNode.indexOf("e")&&-1===this.numberNode.indexOf("E")||Ze(this,"Invalid number has two exponential"),this.numberNode+="e"):r===pe||r===ye?(n!==_e&&n!==xe&&Ze(this,"Invalid symbol in number"),this.numberNode+=String.fromCharCode(r)):(Ve(this),e--,this.state=this.stack.pop()||oe.VALUE);continue;default:Ze(this,"Unknown state: "+this.state)}return this.position>=this.bufferCheckPosition&&function(t){var e=Math.max(ie,10),r=0;for(var n in ae){var i=void 0===t[n]?0:t[n].length;if(i>e)switch(n){case"text":closeText(t);break;default:Ze(t,"Max buffer length exceeded: "+n)}r=Math.max(r,i)}t.bufferCheckPosition=ie-r+t.position}(this),Be(this,"onchunkparsed"),this}}]),t}();function Be(t,e,r){t[e]&&t[e](r,t)}function Re(t,e,r){De(t),Be(t,e,r)}function De(t,e){t.textNode=function(t,e){if(void 0===e)return e;t.trim&&(e=e.trim());t.normalize&&(e=e.replace(/\s+/g," "));return e}(t.options,t.textNode),void 0!==t.textNode&&Be(t,e||"onvalue",t.textNode),t.textNode=void 0}function Ve(t){t.numberNode&&Be(t,"onvalue",parseFloat(t.numberNode)),t.numberNode=""}function Ze(t,e){return De(t),e+="\nLine: "+t.line+"\nColumn: "+t.column+"\nChar: "+t.c,e=new Error(e),t.error=e,Be(t,"onerror",e),t}function Ge(t){return t===le||t===ce||t===fe||t===he}var Je=function(t){function e(){var t;return i(this,e),(t=h(this,c(e).call(this))).topLevelArray=null,t.topLevelObject=null,t._extendParser(),t}return d(e,t),o(e,[{key:"write",value:function(t){l(c(e.prototype),"write",this).call(this,t);var r=[];return this.topLevelArray&&(r=st(this.topLevelArray),this.topLevelArray.length=0),r}},{key:"getPartialResult",value:function(){return this.topLevelObject}},{key:"_extendParser",value:function(){var t=this;this.parser.onopenarray=function(){t.topLevelArray?t._openContainer([]):(t.topLevelArray=[],t._openContainer(t.topLevelArray))},this.parser.onopenobject=function(e){t.topLevelObject?t._openContainer({}):(t.topLevelObject={},t._openContainer(t.topLevelObject)),void 0!==e&&t.parser.onkey(e)}}}]),e}(function(){function t(){i(this,t),this.reset(),this._initializeParser()}return o(t,[{key:"reset",value:function(){this.result=void 0,this.previousStates=[],this.currentState=Object.freeze({container:[],key:null})}},{key:"write",value:function(t){this.parser.write(t)}},{key:"close",value:function(){this.parser.close()}},{key:"_pushOrSet",value:function(t){var e=this.currentState,r=e.container,n=e.key;null!==n?(r[n]=t,this.currentState.key=null):r.push(t)}},{key:"_openContainer",value:function(t){this._pushOrSet(t),this.previousStates.push(this.currentState),this.currentState={container:t,key:null}}},{key:"_closeContainer",value:function(){this.currentState=this.previousStates.pop()}},{key:"_initializeParser",value:function(){var t=this;this.parser=new Ue({onready:function(){t.previousStates.length=0,t.currentState.container.length=0},onopenobject:function(e){t._openContainer({}),void 0!==e&&t.parser.onkey(e)},onkey:function(e){t.currentState.key=e},oncloseobject:function(){t._closeContainer()},onopenarray:function(){t._openContainer([])},onclosearray:function(){t._closeContainer()},onvalue:function(e){t._pushOrSet(e)},onerror:function(t){throw t},onend:function(){t.result=t.currentState.container.pop()}})}}]),t}());function Ye(t,e){return We.apply(this,arguments)}function We(){return(We=re(ut.mark((function t(e,r){var n,i,a,o,s,u,h,c,l,f,d,p,v,y,m,b,g,w,x,M,L,S,k,E,_;return ut.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=r.json,i=n.batchSize,a=n._rootObjectBatches,o=r.json.TableBatch,s=!0,u=null,h=null,c=new Je,u=u||new Xt(o,h,i),l=!0,f=!1,t.prev=9,p=ne(e);case 11:return t.next=13,te(p.next());case 13:return v=t.sent,l=v.done,t.next=17,te(v.value);case 17:if(y=t.sent,l){t.next=63;break}if(m=y,b=c.write(m),!s){t.next=28;break}if(!a){t.next=26;break}return g={batchType:"root-object-batch-partial",container:c.getPartialResult(),data:[],schema:null},t.next=26,g;case 26:s=!1,h=qe(b);case 28:w=!0,x=!1,M=void 0,t.prev=31,L=b[Symbol.iterator]();case 33:if(w=(S=L.next()).done){t.next=42;break}if(k=S.value,u.addRow(k),!u.isFull()){t.next=39;break}return t.next=39,u.getNormalizedBatch();case 39:w=!0,t.next=33;break;case 42:t.next=48;break;case 44:t.prev=44,t.t0=t.catch(31),x=!0,M=t.t0;case 48:t.prev=48,t.prev=49,w||null==L.return||L.return();case 51:if(t.prev=51,!x){t.next=54;break}throw M;case 54:return t.finish(51);case 55:return t.finish(48);case 56:if(u.chunkComplete(),!u.isFull()){t.next=60;break}return t.next=60,u.getNormalizedBatch();case 60:l=!0,t.next=11;break;case 63:t.next=69;break;case 65:t.prev=65,t.t1=t.catch(9),f=!0,d=t.t1;case 69:if(t.prev=69,t.prev=70,l||null==p.return){t.next=74;break}return t.next=74,te(p.return());case 74:if(t.prev=74,!f){t.next=77;break}throw d;case 77:return t.finish(74);case 78:return t.finish(69);case 79:if(!(E=u.getNormalizedBatch())){t.next=83;break}return t.next=83,E;case 83:if(!a){t.next=87;break}return _={batchType:"root-object-batch-complete",container:c.getPartialResult(),data:[],schema:null},t.next=87,_;case 87:case"end":return t.stop()}}),t,null,[[9,65,69,79],[31,44,48,56],[49,,51,55],[70,,74,78]])})))).apply(this,arguments)}function qe(t){var e=t[0],r={},n=0;for(var i in e){switch(s(e[i])){case"number":case"boolean":r[i]={name:String(i),index:n,type:Float32Array};break;case"object":r[i]={name:String(i),index:n,type:Array};break;case"string":default:r[i]={name:String(i),index:n,type:Array}}n++}return r}function Ke(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function Xe(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?Ke(Object(r),!0).forEach((function(e){ht(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Ke(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}var $e={id:"json",name:"JSON",version:"2.1.6",extensions:["json"],mimeType:"text/json",category:"table",testText:null,text:!0,parse:function(t,e){return He.apply(this,arguments)},parseTextSync:Qe,parseInBatches:function(t,e){return tr.apply(this,arguments)},options:{json:{TableBatch:$t,batchSize:"auto"}}};function He(){return(He=lt(ut.mark((function t(e,r){return ut.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Qe((new TextDecoder).decode(e),r));case 1:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function Qe(t,e){return(e=Xe({},$e.options,{},e)).json=Xe({},$e.options.json,{},e.json),Ht(t,e)}function tr(){return(tr=lt(ut.mark((function t(e,r){return ut.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return(r=Xe({},$e.options,{},r)).json=Xe({},$e.options.json,{},r.json),t.abrupt("return",Ye(e,r));case 3:case"end":return t.stop()}}),t)})))).apply(this,arguments)}const er=new class{constructor(){this.ee=n}async initialize({clientId:t,token:e}){e?this.setToken(e):await this.authenticateViaOAuth(t),await this._initialize()}async authenticateViaOAuth(t,e=null){return await new Promise((r,i)=>{n.data.authenticateViaOauth(t,t=>r(t),t=>i(t),e,t=>{n.data.authenticateViaPopup(r,i)})})}setToken(t){t&&n.apiclient.setAuthToken("","Bearer",t,3600,[],void 0,!1)}async _initialize(t=null,e=null){return window.ee=n,await new Promise((r,i)=>{n.initialize(t,e,t=>r(t),t=>i(t))})}};let rr;const nr={...ot.defaultProps,...e.GeoJsonLayer.defaultProps,data:{type:"object",value:null},token:{type:"string",value:null},eeObject:{type:"object",value:null},visParams:{type:"object",value:null,equal:qt},asVector:!1,selectors:{type:"array",value:[],equal:qt},animate:!1,animationSpeed:12,refinementStrategy:"no-overlap"};class ir extends t.CompositeLayer{static async initializeEEApi({clientId:t,token:e}){await er.initialize({clientId:t,token:e})}initializeState(){this.state={}}async updateState({props:t,oldProps:e,changeFlags:r}){await this._updateToken(t,e,r),this._updateEEObject(t,e,r),await this._updateEEVisParams(t,e,r),this._animate()}async _updateToken(t,e,r){if(!t.token||t.token===rr)return;const{token:n}=t;await er.initialize({token:n}),rr=n}_animate(){const{nFrames:t}=this.state;if(!t)return;const{animationSpeed:e}=this.props,r=Date.now()/1e3,n=t/e;this.setState({frame:Math.floor(r%n/n*t)})}_updateEEObject(t,e,r){if(t.eeObject===e.eeObject)return;let i;i="string"==typeof t.eeObject?n.Deserializer.fromJSON(t.eeObject):t.eeObject,i&&t.animate&&(i=n.ImageCollection(i)),Array.isArray(t.eeObject)&&0===t.eeObject.length&&(i=null),this.setState({eeObject:i})}async _updateEEVisParams(t,e,n){if(t.visParams===e.visParams&&!n.dataChanged)return;const{animate:i,asVector:a,selectors:o}=t,{eeObject:s}=this.state;if(!s)return;if(!s.getMap)throw new Error("eeObject must have a getMap() method");let u;if(i){if(u="filmstrip",!s.getFilmstripThumbURL)throw new Error("eeObject must have a getFilmstripThumbURL method to animate.")}else if(a){u="vector";const t=await Kt(s,"getDownloadURL","json",[".geo",...o],""),e=await r.load(t,$e);this.setState({geojsonData:e})}else u="imageTiles";const{mapid:h,urlFormat:c}=await Kt(s,"getMap",t.visParams);this.setState({mapid:h,urlFormat:c,renderMethod:u})}getTileData(t){const{renderMethod:e}=this.state;return"filmstrip"===e?this.getFilmstripTileData(t):this.getImageTileData(t)}async getImageTileData({x:t,y:e,z:n}){const{urlFormat:i}=this.state;if(!i)return null;const a=i.replace("{x}",t).replace("{y}",e).replace("{z}",n),o=await r.load(a,Wt);return Promise.all([o])}async getFilmstripTileData({bbox:t}){const{eeObject:e}=this.state,{visParams:i}=this.props,{west:a,north:o,east:s,south:u}=t,h={...i,dimensions:[256,256],region:n.Geometry.Rectangle([a,u,s,o],"EPSG:4326",!1),crs:"EPSG:3857"},c=await Kt(e,"getFilmstripThumbURL",h),l=await r.load(c,Wt,{image:{type:"imagebitmap"}}),f=l.height/256,d=[];for(let t=0;t<f;t++){const e=[0,256*t,256,256];d.push(createImageBitmap(l,...e))}return this.setState({nFrames:f}),Promise.all(d)}_renderGeoJsonLayer(){const{mapid:t,geojsonData:r}=this.state,{stroked:n,filled:i,extruded:a,wireframe:o,lineWidthUnits:s,lineWidthScale:u,lineWidthMinPixels:h,lineWidthMaxPixels:c,lineJointRounded:l,lineMiterLimit:f,elevationScale:d,pointRadiusScale:p,pointRadiusMinPixels:v,pointRadiusMaxPixels:y,getLineColor:m,getFillColor:b,getRadius:g,getLineWidth:w,getElevation:x,material:M}=this.props;return r?new e.GeoJsonLayer(this.getSubLayerProps({id:t}),{data:r,stroked:n,filled:i,extruded:a,wireframe:o,lineWidthUnits:s,lineWidthScale:u,lineWidthMinPixels:h,lineWidthMaxPixels:c,lineJointRounded:l,lineMiterLimit:f,elevationScale:d,pointRadiusScale:p,pointRadiusMinPixels:v,pointRadiusMaxPixels:y,getLineColor:m,getFillColor:b,getRadius:g,getLineWidth:w,getElevation:x,material:M}):null}renderLayers(){const{mapid:t,frame:r=0,renderMethod:n}=this.state,{refinementStrategy:i,onViewportLoad:a,onTileLoad:o,onTileError:s,maxZoom:u,minZoom:h,maxCacheSize:c,maxCacheByteSize:l}=this.props;return t&&("vector"===n?this._renderGeoJsonLayer():new ot(this.getSubLayerProps({id:t}),{refinementStrategy:i,onViewportLoad:a,onTileLoad:o,onTileError:s,maxZoom:u,minZoom:h,maxCacheSize:c,maxCacheByteSize:l,frame:r,getTileData:t=>this.getTileData(t),renderSubLayers(t){const{data:n,tile:i}=t,{west:a,south:o,east:s,north:u}=i.bbox,h=[a,o,s,u];if(!n)return null;let c;return Array.isArray(n)?c=n[r]:n&&(c=n.then(t=>t&&t[r])),c&&new e.BitmapLayer({...t,image:c,bounds:h})}}))}}ir.layerName="EarthEngineLayer",ir.defaultProps=nr;const ar={EarthEngineLayer:ir};return("undefined"==typeof window?global:window).EarthEngineLayerLibrary=ar,ar}(deck,deck,loaders,ee);
